/**
* gtpl v1.1.1
* (c) 2024 Manuel Peliz
* @license LGPL-2.1 license
* @repository https://github.com/garag-lib/GTPL
**/
!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.gtpl=t():e.gtpl=t()}(this,(()=>(()=>{"use strict";var e={d:(t,n)=>{for(var r in n)e.o(n,r)&&!e.o(t,r)&&Object.defineProperty(t,r,{enumerable:!0,get:n[r]})}};e.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),e.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t);var t={};function n(e){const t={},n=e.toLowerCase().replace(/-(.)/g,((e,t)=>t.toUpperCase())).replace(/;\s?$/g,"").split(/:|;/g);for(let e=0,r=n.length;e<r;e+=2)t[n[e].replace(/\s/g,"")]=n[e+1].replace(/^\s+|\s+$/g,"");return t}function r(e){return e.replace(/([a-z])([A-Z])/g,"$1-$2").toLocaleLowerCase()}e.d(t,{default:()=>le});const s=["symbol","bigint","undefined","boolean","string","number"];function i(e){if(null==e)return!0;const t=typeof e;return s.includes(t)}function o(e,t=0){const n="  ".repeat(t);console.log(`${n}Array [`),e.forEach((e=>{Array.isArray(e)?o(e,t+1):"object"==typeof e&&null!==e?l(e,t+1):console.log(`${n}  ${e}`)})),console.log(`${n}]`)}function l(e,t=0){const n="  ".repeat(t);console.log(`${n}{`);for(const r in e)if(e.hasOwnProperty(r)){const s=e[r];Array.isArray(s)?(console.log(`${n}  ${r}: `),o(s,t+1)):"object"==typeof s&&null!==s?(console.log(`${n}  ${r}: `),l(s,t+1)):console.log(`${n}  ${r}: ${s}`)}console.log(`${n}}`)}function a(...e){console.log("%c----------","font-weight:bold"),e.forEach((e=>{Array.isArray(e)?o(e):"object"==typeof e&&null!==e?l(e):console.log(e)})),console.log("%c----------","font-weight:bold")}function c(...e){e.push(new Error(e.shift()).stack),a(...e)}const h=Symbol("is proxy"),u=Symbol("proxy target");function f(e,t,n,r){return new Proxy(e,function(e,t,n){return{get:(r,s,o)=>{if(s==h)return!0;if(s==u)return r;const l=Reflect.get(r,s,o);return i(l)||l[h]?l:f(l,e,t,[n,s])},set:(r,s,o)=>{if(!i(o))for(;o[h];)o=o[u];const l=Reflect.set(r,s,o);return e(0,[n,s],o,t),l},deleteProperty:(r,s)=>{const i=Reflect.deleteProperty(r,s);return e(1,[n,s],void 0,t),i}}}(t,n,r))}function p(e,t=[]){return e.forEach((function(e){Array.isArray(e)?p(e,t):t.push(e)})),t}let d=null;function g(e){return e&&e.Math===Math&&e}try{d=g("object"==typeof globalThis&&globalThis)||g("object"==typeof window&&window)||g("object"==typeof self&&self)||g("object"==typeof e.g&&e.g)||function(){return this}()||Function("return this")()}catch(e){}const m=d;let y=null;try{const e={get passive(){return y=!0,!1}};m.addEventListener("test",null,e),m.removeEventListener("test",null,e)}catch(e){y=!1}const k=y;function v(e,t,n){return n&&(e.mark=n),t&&(e.ele=t),e}function b(e,t,n){Array.isArray(t)?t.forEach((t=>{b(e,t,n)})):"function"==typeof t?b(e,t(n),n):null!=t&&(Array.isArray(e)?e.push(t):e.appendChild(t))}function E(e,t,n,r){let s=null;switch(e){case"#text":null==s&&(s=m.document.createTextNode("")),"string"==typeof t&&(s.textContent=t);case"#comment":return null==s&&(s=m.document.createComment("")),"string"==typeof t?s.textContent=t:t.forEach((e=>{"string"!=typeof e?Array.isArray(e)?console.error(s,e):0==e.type?r.addBind(v(e,s)):r.addBind(v(e,void 0,s)):s.textContent=e})),s;default:const i=m.document.createElement(e);return b(i,n,r),Array.isArray(t)&&t.forEach((e=>{if(Array.isArray(e))i.setAttribute(e[0],e[1]);else{const t=e;r.addBind(v(t,i))}})),i}}const w=E,x=b,A={binitChangeEvents:!1};class C{static globalVar=new WeakMap;static init(e){C.globalVar.has(e)||C.globalVar.set(e,{GenerationFinish:!1,MarkEle:new WeakMap,memValues:new WeakMap,renderElements:new Set})}static getProperty(e,t){return C.init(e),C.globalVar.get(e)[t]}static setProperty(e,t,n){C.init(e),C.globalVar.get(e)[t]=n}}const R=new WeakMap;function N(e,t){const n=C.getProperty(e,"renderElements");n.has(t)||n.add(t)}function P(e,t,n,r=!1){if(e.length>1){const s=(t,n,r)=>n==r?t[e[n]]:s(t[e[n]],++n,r),i=s(t.Root,0,e.length-2),o=e[e.length-1];(r||i[o]!=n)&&(i[o]=n)}else{const s=e[0];(r||t.Root[s]!=n)&&(t.Root[s]=n)}}function j(e,t,n,r,s){if(null==r&&(r=0),void 0!==s&&r>=t.length-s)return n;const i=null==n?e.getValue(t[r++]):n[t[r++]];return void 0!==s&&r>=t.length-s||r>=t.length?i:j(e,t,i,r)}async function O(e,t,n,r){null==n&&(n=0);const s=t[n++],i=e.getContext(s.name[0]),o=j(i,s.name),l=[];s.params&&s.params.forEach((t=>{null!=t.ct?l.push(t.ct):null!=t.va&&l.push(j(e,t.va))})),null!=r&&l.push(r);try{r=await o.apply(i.Root,l)}catch(e){c(e.message,o),r=void 0}return n>=t.length?r:await O(e,t,n,r)}async function S(e,t,n,r){let s;const i=t.gtpl?t.gtpl:e;if(t.link.formula&&t.link.formula.fnc){const e=t.link.formula.fnc,n=[];t.link.formula.vars&&t.link.formula.vars.forEach((e=>{n.push(i.getValue(e[0]))})),r&&n.push(r);try{s=await e.apply(i.Root,n)}catch(t){c(t.message,e),s=void 0}}else t.link.vorc&&(null!=t.link.vorc.va&&(s=null!=n?n:j(i,t.link.vorc.va)),null!=t.link.vorc.ct&&(s=t.link.vorc.ct)),t.link.functions&&(s=await O(i,t.link.functions,0,s));return s}function $(e,t){let n=e;if(t.link.vorc&&t.link.vorc.va)n=e.getContext(t.link.vorc.va[0]);else if(t.link.functions){const r=t.link.functions[0];n=e.getContext(r.name[0])}return n}function V(e,t,n){const r=t[0];if(null!=e.BindTree[r])return;const s={key:r,val:e.getValue(r),pro:void 0};e.BindDef.add(s);try{e.Root.hasOwnProperty(r)||(e.Root[r]=null),Object.defineProperty(e.Root,r,{get:function(){if(void 0!==s.pro)return s.pro;if(i(s.val))return s.val;for(;s.val[h];)s.val=s.val[u];return s.pro=f(s.val,e.eventPRoxy.bind(e),s,[s.key]),s.pro},set:function(t){if(s.val=t,i(t))return delete s.pro,e.eventPRoxy(0,[s.key],t,s),s.val;for(;s.val[h];)s.val=s.val[u];return s.pro=f(s.val,e.eventPRoxy.bind(e),s,[s.key]),e.eventPRoxy(0,[s.key],t,s),s.pro}})}catch(t){c(t.message,r,e.Root)}}function B(e,t,n){let r=e.BindTree;for(let s=0,i=t.length;s<i;s++){const o=t[s];if(0==s){const r=e.getContext(o);if(V(r,t),r!=e)return n.gtpl=e,e.BindMap||(e.BindMap=new Map),e.BindMap.set(n,r),void B(r,t,n)}null==r[o]&&(r[o]={}),s<i-1?(r=r[o],null==r.tree&&(r.tree={}),r=r.tree):r=r[o]}null==r.me&&(r.me=new Set),r.me.add(n)}function M(e,t,n){let r=e.BindTree;for(let e=0,n=t.length;e<n;e++){const s=t[e];e<n-1?(r=r[s],r=r.tree):r=r[s]}return r.me}function T(e,t){t.link.vorc&&t.link.vorc.va&&M(e,t.link.vorc.va).delete(t),t.link.formula?.vars&&t.link.formula.vars.forEach((n=>{M(e,n).delete(t)}))}function G(e,t){let n=!1;if(t.link.vorc&&t.link.vorc.va&&M(e,t.link.vorc.va).has(t)&&(n=!0),t.link.formula?.vars&&t.link.formula.vars.forEach((r=>{M(e,r).has(t)&&(n=!0)})),!n){const n=C.getProperty(e,"renderElements");n.has(t)&&n.delete(t)}return n}function L(e){Array.isArray(e)?e.forEach((e=>{e.destroy?e.destroy(!0):L(e)})):e.destroy?e.destroy(!0):e.parentNode?.removeChild(e)}function F(e,t,n,r,s=[]){if(e&&(e.me&&e.me.forEach((e=>{s.push([t,e,n,n.length?void 0:r])})),e.tree)){const i=Array.isArray(n)?n.shift():void 0;for(let o in e.tree)null!=i&&i!=o||F(e.tree[o],t,n,null!=r?null==i?r[o]:r:void 0,s)}return s}function J(e,t,n){if(n){const n=C.getProperty(e,"MarkEle"),r=C.getProperty(e,"memValues");t.ele?n.has(t.mark)&&t.ele!=n.get(t.mark)&&(t.ele=n.get(t.mark),r.delete(t)):t.mark&&(t.gen?(n.has(t.mark)?t.ele=n.get(t.mark):(t.ele=t.gen(t.gtpl?t.gtpl:e),n.set(t.mark,t.ele)),delete t.gen):n.has(t.mark)&&(t.ele=n.get(t.mark),r.delete(t)))}}function D(e,t=!0){e.ele&&(Array.isArray(e.ele)?e.ele.forEach((t=>{e.mark.parentNode.insertBefore(t,e.mark)})):e.mark.parentNode.insertBefore(e.ele,e.mark),t&&e.mark.remove())}function W(e,t=!0){e.ele&&(Array.isArray(e.ele)?(t&&e.ele[0].parentNode.insertBefore(e.mark,e.ele[0]),e.ele.forEach((e=>{e.remove()}))):(t&&e.ele.parentNode.insertBefore(e.mark,e.ele),e.ele.remove()))}function z(e,t,n){const r=_(e,t),s=function(e){let t=!0;if(e.mark.checks)for(let n in e.mark.checks)if(!e.mark.checks[n]){t=!1;break}return t}(t);return n&&s?(r>=0&&(e.RenderElements[r]=t),t.mark.parentNode?D(t):r>=0&&G(e,t)&&N(e,t)):(r>=0&&delete e.RenderElements[r],t.ele.parentNode?W(t):r>=0&&G(e,t)&&N(e,t)),!(n&&!s)}function _(e,t){const n=e.Elements.indexOf(t.mark);return n>=0&&(e.RenderElements||(e.RenderElements={})),n}function I(e,t,n,r,s,i){const o={parent:t.gtpl?t.gtpl:e,generator:t.gen};if(n&&r&&s){const e={};e[n.index]=r.length,e[n.target]=s,o.context=[n.index,n.target],o.root=e}return void 0!==i&&(o.refresh=i),new Z(o)}class Z{ID;FncElements;Elements;RenderElements;BindTree;BindConst;BindMap;BindDef;GtplChilds;Parent;Context;Root;constructor(e){this.ID=Math.random().toString(16).slice(2),this.BindTree={},this.BindConst=new Set,this.BindDef=new Set,this.GtplChilds=new Set,this.loadOptions(e)}loadOptions(e){e&&(this.Root=e.root,e.parent&&(this.Parent=e.parent),e.context&&(this.Context=new Set(e.context)),e.generator&&(this.FncElements=e.generator,this.Elements=[],x(this.Elements,this.FncElements,this)),C.setProperty(this,"GenerationFinish",!0),void 0!==e.refresh&&!0!==e.refresh||this.refresh())}getValue(e){const t=this.Root;if(t){if(t.hasOwnProperty(e))return t[e];if(void 0!==t[e])return t[e]}if(this.Parent)return this.Parent.getValue(e)}getGtplRoot(){return this.Parent?this.Parent.getGtplRoot():this}getRoot(){return this.Parent?this.Parent.getRoot():this.Root}getContext(e){return this.Context&&this.Context.has(e)?this:this.Parent?this.Parent.getContext(e):this.getGtplRoot()}addBind(e){(function(e,t){if(15==t.type){if(t.link.svar&&t.link.vorc&&t.link.vorc.va){const n=t.link.vorc.va.join("");t.ele[t.link.svar]="this"==n?e.Root:j(e,t.link.vorc.va)}return!0}return!1})(this,e)||function(e,t){if(6==t.type&&t.prop){const n={gtpl:$(e,t),bind:t},r={passive:!1};return["wheel","mousewheel","touchstart","touchmove"].includes(t.prop.toLowerCase())&&(r.passive=!0),t.ele.addEventListener(t.prop,(async function(t){const r=await S(n.gtpl,n.bind,void 0,t);if("function"==typeof r)if(n.bind.link.params){const s=[];n.bind.link.params.forEach((t=>{null!=t.ct?s.push(t.ct):null!=t.va&&s.push(j(e,t.va))})),r.apply(n.gtpl.Root,[t,...s])}else r.apply(n.gtpl.Root,[t]);else t.preventDefault&&t.preventDefault()}),!!k&&r),!0}return!1}(this,e)||function(e,t){let n=!1;return t.link.formula&&t.link.formula.vars&&t.link.formula.vars.length&&(n=!0,t.link.formula.vars.forEach((n=>{B(e,n,t)}))),n}(this,e)||function(e,t){let n=!1;return t.link.vorc&&t.link.vorc.va&&(n=!0,function(e,t){if(7==t.type&&t.prop&&t.link&&t.link.vorc&&t.link.vorc.va){const{prop:n}=t;if(n.startsWith("[")&&n.endsWith("]")){!function(){if(!A.binitChangeEvents)try{A.binitChangeEvents=!0;const e=function(e){const t=e.target;if(R.has(t)){const e=R.get(t);if(e)for(let n of e)P(n.va,n.ctx,t.value)}};m.addEventListener&&(m.addEventListener("input",e),m.addEventListener("change",e))}catch(e){c(e.message)}}(),t.simetric=!0,t.prop=n.slice(1,-1);const r=t.link.vorc.va,s=e.getContext(r[0]);if("value"==t.prop&&(R.has(t.ele)||R.set(t.ele,new Set),R.get(t.ele)?.add({va:r,ctx:s})),t.prop in t.ele.constructor.prototype){const e=Object.getOwnPropertyDescriptor(t.ele.constructor.prototype,t.prop);e?Object.defineProperty(t.ele,t.prop,{get:function(){return e.get.call(this)},set:function(n){if("value"==t.prop&&"select"==t.ele.nodeName.toLowerCase()){const t=e.set.call(this,n);return e.get.call(this)==n?P(r,s,n):a("select value not valid",n+" not in options"),t}return P(r,s,n),e.set.call(this,n)}}):a("simetric attr error",t.prop," not in ",t.ele.constructor.prototype)}else a("simetric attr error",t.prop," in ",t.ele)}}}(e,t),B(e,t.link.vorc.va,t)),t.link.functions&&t.link.functions.forEach((r=>{r.params&&r.params.forEach((r=>{r.va&&(n=!0,B(e,r.va,t))}))})),n}(this,e)||this.BindConst.add(e),C.getProperty(this,"GenerationFinish")&&this.launchChange(3,e)}destroy(e=!0){const t=Array.isArray(this.Elements)?this.Elements.length:1;if(this.GtplChilds.forEach((e=>{e.destroy(!1)})),this.BindMap)for(let[e,t]of this.BindMap)T(t,e);if(e&&(L(this.Elements),this.RenderElements)){for(let e=0;e<t;e++)if(this.RenderElements[e]){const t=this.RenderElements[e];t.ele?L(t.ele):t.eles&&L(t.eles)}delete this.RenderElements}}refresh(){for(let e of this.BindDef)this.eventPRoxy(4,[],void 0,e);if(this.BindMap)for(let[e,t]of this.BindMap)t.launchChange(5,e);if(this.BindConst)for(let e of this.BindConst)this.launchChange(6,e)}addTo(e){if(this.RenderElements){const t=[];(Array.isArray(this.Elements)?this.Elements:[this.Elements]).forEach(((e,n)=>{if(this.RenderElements[n]){const e=this.RenderElements[n];e.ele?t.push(e.ele):e.eles&&(e.eles.forEach((e=>e.addTo(t))),t.push(e.mark))}else t.push(e)})),x(e,t,this)}else x(e,this.Elements,this)}eventPRoxy(e,t,n,r){const s=p(t);s?.shift(),F(this.BindTree[r.key],e,s,n).forEach((e=>this.launchChange.apply(this,e)))}async launchChange(e,t,n,r){const s=await S(this,t,r);let i=this;switch(t.type){case 0:i=await async function(e,t,n,r,s){t=$(t,n);const i=C.getProperty(t,"memValues");if(null!=r){if(i.has(n)&&i.get(n)==r)return t;i.set(n,r)}return n.ele.textContent=r,t}(0,this,t,s);break;case 7:i=await async function(e,t,n,r,s){t=$(t,n);const i=(e,t)=>{if(void 0!==n.ele[e]&&null!==n.ele[e]){if(null==t)""!==n.ele[e]&&(n.ele[e]=null);else if(n.ele[e]!=t)try{n.ele[e]=t}catch(t){c(t.message,n.ele,e)}}else null==t?n.ele.removeAttribute(e):n.ele.getAttribute(e)!=t&&n.ele.setAttribute(e,t)};if(n.prop)i(n.prop,r);else if(null==r)n.attrs&&(n.attrs.forEach((e=>{i(e,null)})),delete n.attrs);else{n.attrs||(n.attrs=[]),n.attrs.filter((e=>!(e in r))).forEach((e=>{i(e,null)})),n.attrs.length=0;for(let e in r)n.attrs.push(e),i(e,r[e])}return t}(0,this,t,s);break;case 9:i=await async function(e,t,n,r,s){return t=$(t,n),void 0!==r&&n.ele.innerHTML!=r&&(n.ele.innerHTML=r),t}(0,this,t,s);break;case 8:i=await async function(e,t,n,r,s){t=$(t,n);const i=C.getProperty(t,"memValues");return i.has(n)&&i.get(n)==r||(i.set(n,r),n.prop&&(n.ele.style[n.prop]=r)),t}(0,this,t,s);break;case 1:case 2:i=await async function(e,t,n,r,s){t=$(t,n);const i=2==n.type?!r:!!r;if(n.mark.checks||(n.mark.checks={}),n.mark.checks[n.type]=i,J(t,n,i),!n.ele)return t;const o=C.getProperty(t,"memValues");return o.has(n)&&o.get(n)===i||z(t,n,i)&&o.set(n,i),t}(0,this,t,s);break;case 5:i=await async function(e,t,n,r,s){t=$(t,n),n.eles||(n.eles=[]);const i=n.eles,o=n.link.index,l=[],a=[],c=Array.isArray(s)&&s.length?s[0]:void 0;if(isNaN(c))if(r&&r.length){if("length"==c&&i.length==r.length)return t;r.forEach(((e,r)=>{if(r>=i.length){const s=I(t,n,o,i,e,!1);i.push(s),l.push([s,r])}else i[r].Root[o.target]=e})),i.length>r.length&&i.splice(r.length,i.length-r.length).forEach(((e,t)=>{a.push([e,t])}))}else i.length&&(i.forEach(((e,t)=>{a.push([e,t])})),i.length=0);else{const h=s;if(0==e){let e=!1;if(h.length>1)e=!0;else if(1==h.length&&i.length==r.length)return i[c].Root[o.target]=r[c],t;if(e){const e=i[c];h.shift(),P(h,{Root:e.Root[o.target]},j(t,h,r[c]),!0)}else{const e=I(t,n,o,i,r[c],!1);i.push(e),l.push([e,c])}}if(1==e)if(h.length>1)i[c].Root[o.target]=r[c];else{const e=i.splice(c,1)[0];a.push([e,c])}}if(a.length&&a.forEach((e=>{const[n,r]=e;n.destroy(),t.GtplChilds.delete(n)})),l.length){const e=_(t,n);e>=0&&(t.RenderElements[e]||(t.RenderElements[e]=n));const r=[];l.forEach((e=>{const[n,s]=e;n.addTo(r),t.GtplChilds.add(n)})),n.mark.parentNode?(D({type:n.type,link:n.link,ele:r,mark:n.mark},!1),l.forEach((e=>{e[0].refresh()}))):e>=0&&G(t,n)&&N(t,n)}return t}(e,this,t,s,n);break;case 3:i=await async function(e,t,n,r,s){t=$(t,n);const i=null!=r;if(n.mark.checks||(n.mark.checks={}),n.mark.checks[n.type]=i,J(t,n,i),n.mark.checks||(n.mark.checks={}),n.mark.checks[n.type]=null!=r,!n.ele)return t;const o=C.getProperty(t,"memValues");if(o.has(n)&&o.get(n)===r)return t;if(o.set(n,r),n.case&&n.case.length){if(n.eles&&n.eles.length&&(n.eles.forEach((e=>{W(e.refCase),e.destroy(),t.GtplChilds.delete(e)})),delete n.eles),!G(t,n))return t;if(i){if(!n.case[0].mark){const e={};for(let t=0,r=n.ele.childNodes.length;t<r;t++){const r=n.ele.childNodes[t];8===r.nodeType&&6==r.textContent.length&&(e[r.textContent]=r)}for(let t=0,r=n.case.length;t<r;t++){const r=n.case[t];!r.mark&&r.uid&&(r.mark=e[r.uid])}}for(let e=0,s=n.case.length;e<s;e++){const s=n.case[e];if(await S(t,s)==r){const e=I(t,s,void 0,void 0,void 0,!1);s.ele=e.Elements,s.eles=[e],e.refCase=s,t.GtplChilds.add(e),n.eles=s.eles;break}}}}return z(t,n,i)&&i&&(n.eles[0].refresh(),D(n.eles[0].refCase)),t}(0,this,t,s);break;case 12:i=await async function(e,t,n,r,s){t=$(t,n);const i=null!=r,o=C.getProperty(t,"memValues");if(o.has(n)&&o.get(n)==r)return t;o.set(n,r);let l=!1;if(n.eles?(l=!0,n.eles[0].destroy(),t.GtplChilds.delete(n.eles[0]),delete n.eles):n.ele&&W(n),!i)return t;if(l&&!G(t,n))return t;if(Array.isArray(r)||"function"==typeof r){const e=I(t,{link:n.link,type:n.type,gtpl:n.gtpl,gen:r});n.eles=[e],t.GtplChilds.add(e),n.ele=e.Elements}else n.ele=r;return C.getProperty(t,"MarkEle").set(n.mark,n.ele),z(t,n,i),t}(0,this,t,s)}!function(e,t){const n=C.getProperty(e,"renderElements");n.has(t)&&(Array.isArray(e.Elements)?e.Elements:[e.Elements]).forEach(((t,r)=>{const s=e.RenderElements[r];if(s&&n.has(s)){let e=!0;if(s.ele){const t=Array.isArray(s.ele)?s.ele[0]:s.ele;s.mark.parentNode||t.parentNode?s.mark.parentNode&&!t.parentNode&&(D(s),s.eles&&(s.eles[0].refresh(),s.eles[0].refCase&&D(s.eles[0].refCase))):e=!1}else if(s.eles)if(s.mark.parentNode){let e=null;const t=[];s.eles.forEach((n=>{const r=[];n.refresh(),n.addTo(r),r.forEach((n=>{n.parentNode?e||(e=n):t.push(n)}))})),t.length&&D({type:s.type,link:s.link,ele:t,mark:e||s.mark},!1)}else e=!1;e&&n.delete(s)}}))}(i,t)}}const H=["abstract","await","boolean","break","byte","case","catch","char","class","const","continue","debugger","default","delete","do","double","else","enum","export","extends","false","final","finally","float","for","function","goto","if","implements","import","in","instanceof","int","interface","let","long","native","new","null","package","private","protected","public","return","short","static","super","switch","synchronized","this","throw","throws","transient","true","try","typeof","var","void","volatile","while","with","yield","arguments","await","async","eval"];class X{s;i;l;r;arr_acepted;ln;constructor(){this.setAceptedAN()}getResult(){return this.r}getSingleResult(){let e=null;return this.r&&1==this.r.length&&(e=this.r[0]),e}setString(e){this.s=e,this.l=e.length,this.i=0,this.r=[]}setAceptedAN(e="_"){this.arr_acepted=Array.from(e).map((e=>e.charCodeAt(0)))}isAN(e,t=!0){if(null==e)return!1;let n;for(let r=0,s=e.length,i=0;r<s;r++)if(i=e.charCodeAt(r),n=i>64&&i<91||i>96&&i<123||this.arr_acepted.indexOf(i)>=0,t&&(n=n||i>47&&i<58),!n)return!1;return!0}checkStart(){return"{"==this.s[this.i]&&"{"==this.s[this.i+1]}checkEnd(){return"}"==this.s[this.i]&&"}"==this.s[this.i+1]}next(){return this.i++,!(this.i>=this.l)}nop(e=!1,t=null){let n=null;for(this.ln=null;;){if(n=this.s[this.i],t===n)return!0;let r=" "==n||"\t"==n||"\r"==n||"\n"==n;if(!r&&e&&(r='"'!=n&&"'"!=n&&!this.isAN(n),r&&(this.ln=n)),!r)return!0;if(!this.next())return!1}}getVOrC(){let e=this.s[this.i];return'"'==e||"'"==e?{ct:this.getConst()}:this.isAN(e,!1)?{va:this.getVar()}:null}getVar(e=!0){let t,n=this.s[this.i],r=null;for(;;){if(!this.next())return""!=n?n.split("."):null;if(r=this.s[this.i],t=this.isAN(r),e&&!t&&(t="."==r),!t)return n.split(".");n+=r}}getConst(){const e=this.s[this.i];if(!this.next())return null;let t=this.s[this.i];if(t==e)return t="",this.next()?t:null;let n=null,r=null;for(;;){if(!this.next())return null;if(n=this.s[this.i],n==e&&"\\"!=r)return this.next()?t:null;t+=n,r=n}}check(){let e,t,n,r=0,s="",i=!1;for(;;){if(this.checkStart()){if(i=!0,""!=s&&(this.r.push(s),s=""),e={},this.i+=2,r=this.i,!this.nop())return!1;if(t=this.getVOrC(),t){if(e.vorc=t,n=this.s[this.i],null==n)break;for(;;)if(":"==n){if(!this.next())return!1;const r=this.getVar();if(null===r)return!1;e.functions||(e.functions=[]);const s={name:r};if(e.functions.push(s),n=this.s[this.i],null==n)break;if("("==n){if(!this.next())return!1;if(n=this.s[this.i],")"==n){if(!this.next())return!1;n=this.s[this.i];continue}for(;;){if(t=this.getVOrC(),!t)return!1;if(n=this.s[this.i],s.params||(s.params=[]),s.params.push(t),null==n)break;if(","!=n){if(")"==n){if(!this.next())return!1;n=this.s[this.i];break}}else{if(!this.next())return!1;n=this.s[this.i]}}}}else{if("#"!=n)break;if(!this.next())return!1;if(t=this.getVOrC(),!t)return!1;e.params||(e.params=[]),e.params.push(t),n=this.s[this.i]}if(";"==n){if(!this.next())return!1;const t=this.getVar(!1);if(null===t)return!1;if(n=this.s[this.i],";"!=n)return!1;{if(!this.next())return!1;const n=this.getVar(!1);if(null===n)return!1;e.index={index:t.join(""),target:n.join("")}}}if(!this.nop())return!1;if(this.checkEnd())this.i++,this.r.push(e);else if(!this.searchFormula(r))return!1}else if(!this.searchFormula(r))return!1}else s+=this.s[this.i];if(!this.next())break}return""!=s&&this.r.push(s),i}searchFormula(e){let t=this.s.substring(e,this.i);for(;;){if(this.checkEnd()){this.i++,this.r.push({formula:{code:t,vars:this.findVars(t)}}),t="";break}if(t+=this.s[this.i],!this.next())return!1}return!0}findVars(e){const t=this.s,n=this.l,r=this.i;this.s=e,this.l=e.length,this.i=0;let s=[],i=null,o=!1,l=[],a=[[]],c=["const","var","let"],h=null;for(;;){let e=l.length?l[l.length-1]:null;if(null!==h&&("}"==e||null===e?e=">":h=null),!this.nop(!0,e))break;if(null!==e){let e=this.s[this.i];if(">"==e){if(!this.next())break;if("="==this.ln&&null!==h){if(a.push(s.splice(h).map((e=>e[0]))),!this.nop(!0,"{"))break;e=this.s[this.i],"{"==e?l.push("}"):a.pop()}h=null;continue}if("("==e){if(o=!0,l.pop(),l.push(")"),!this.next())break;continue}if(")"==e){if(o=!1,l.pop(),l.push("{"),!this.next())break;continue}if("{"==e){if(l.pop(),l.push("}"),!this.next())break;continue}if("}"==e){if(l.pop(),a.pop(),!this.next())break;continue}}if(i=this.getVOrC(),i&&i.va){const e=i.va;if(H.indexOf(e[0])>=0){if("function"==i.va[0])a.push([]),l.push("(");else if(c.includes(e[0])){if(!this.nop(!0))break;i=this.getVOrC(),i&&i.va&&a[a.length-1].push(i.va[0])}continue}if(m.hasOwnProperty(e[0]))continue;if("."==this.ln)continue;if(o)a[a.length-1].push(e[0]);else{if(a.length&&a.some((t=>t.includes(e[0]))))continue;s.some((t=>t[0]==e[0]))||("("==this.ln?h=s.length:","!=this.ln&&null!==h&&(h=null),s.push(e))}}else if(!this.next())break}return this.s=t,this.i=r,this.l=n,s}}let Y,q=0,U=0;const K=/([a-zA-Z\_][\w]+)\s*\=\s*([a-zA-Z][\w\.]+)/gi;function Q(e,t,n){return"g('"+e+"',"+(t||"null")+","+(n||"null")+",o)"}function ee(e,t,n){if(n){let r=[];return n.forEach((e=>{r.push("const "+e.var+"="+e.gen+";")})),"((o)=>{"+r.join("")+"return "+e+"})"+(t?"":"(o)")}return"((o)=>"+e+")"+(t?"":"(o)")}function te(e,t,n,r){let s=se([e],!0);return s=s.substring(0,s.length-1),s=s+',"gen":'+(n||t)+(r||"")+"}",s}function ne(e,t,n,r,s,i){return e.uid=t,n?(""!=r&&(r+=","),r+=te(e,t,void 0,i)):(""!=s&&(s+=","),s+=te(e,t,void 0,i)),{jsonAttr2:r,jsonAttr:s}}function re(e,t,s){let i=null;switch(t){case"g-is":i=i||12;case"g-binds":i=i||11;case"g-bind":i=i||10;case"g-attr":i=i||7;case"g-if":i=i||1;case"g-notif":i=i||2;case"g-switch":i=i||3;case"g-case":i=i||4;case"g-for":i=i||5;case"g-inner":if(i=i||9,Y.setString(`{{${s}}}`),Y.check()){const t={type:i,link:Y.getSingleResult()};return 12===i?e.unshift(t):e.push(t),!0}break;case"g-var":if(i=i||15,s.match(K)){const t=s.split(K);return e.push({type:i,link:{svar:t[1],vorc:{va:t[2].split(".")}}}),!0}break;case"g-tpl":return i=i||14,e.push({type:i,link:{vorc:{ct:s}}}),!0;case"style":let o="";if(Y.setString(s),Y.check()){let t=Y.getResult();if(t&&t.length){if(1==t.length)return e.push({type:8,prop:"cssText",link:t[0]}),!0;const i=n(s);for(const[n,s]of Object.entries(i))Y.setString(s),Y.check()?(t=Y.getSingleResult(),e.push({type:8,prop:n,link:t})):(o+=o?";":"",o+=`${r(n)}:${s}`);return""!=o&&e.push(["style",o]),!0}}break;default:if(Y.setString(s),Y.check()){const n=Y.getResult();if(n&&1==n.length){const r={type:t.startsWith("on")?6:7,prop:t.startsWith("on")?t.substring(2):t,link:n[0]};return e.push(r),!0}}}return!1}function se(e,t=!1){const n=e.map((e=>{if(Array.isArray(e)||"string"==typeof e)return JSON.stringify(e);{const t=e;return t.link?.formula?`{${Object.entries(t).map((([e,t])=>"link"===e?`"${e}":{${Object.entries(t).map((([e,t])=>{if("formula"===e){const{vars:n,code:r}=t;if(null!=r){const t=n?.map((e=>e[0])).join(",")||"",s=r.match(/[\s;]await[\W]/gm)?" async ":"",i=`{${r}}`;return`"${e}":{"vars":${JSON.stringify(n)},"fnc":${s}function(${t})${i}}`}a("formula without code")}return`"${e}":${JSON.stringify(t)}`})).join(",")}}`:`"${e}":${JSON.stringify(t)}`)).join(",")}}`:JSON.stringify(e)}}));return t?n.join(","):`[${n.join(",")}]`}function ie(){return q++,q>9999&&(U=1,U++),function(e){const t="abcdefghijklmnopqrstuvwxyz";let n="";return n+=t[Math.floor(e/26)],n+=t[e%26],n}(U)+String(q).padStart(4,"0")}async function oe(e,t,n,r){null==Y&&(Y=new X);let s,i,o,l,a,c,h,u,f,p,d,g,y,k,v,b,E="";!1!==n&&(E="[");for(var w=0,x=e.length;w<x;w++){var A=e[w];switch(s=i=o=l=a=c=null,p=d=g=y=k="",A.nodeType){case 1:if("script"==A.nodeName.toLowerCase()){"["!=E&&(E+=","),E+=Q(A.nodeName,JSON.stringify(A.textContent));continue}h=A,v=[];for(let e=0,t=h.attributes.length,n=h.attributes;e<t;e++){const t=n.item(e);if(t)if(re(v,t.name,t.value)){if(v.length){const e=v[v.length-1];if(e){if(12==e.type&&(a=e,v.pop()),1!=e.type&&2!=e.type||(l=e,v.pop()),5==e.type&&(s=e,v.pop()),3==e.type&&(i=e,v.pop()),4==e.type){if(!r)throw new Error("not switch");r.case||(r.case=[]),r.case.push(e),o=e,o.index=r.case.length-1,v.pop()}14==e.type&&(c=e,v.pop())}}}else v.push([t.name,t.value])}if(s&&o)throw new Error("not for and case "+Array.from(h.attributes,(e=>e.name+'="'+e.value+'"')).join(" "));if(l&&o)throw new Error("not if and case "+Array.from(h.attributes,(e=>e.name+'="'+e.value+'"')).join(" "));if(a&&(o||i||c))throw new Error("not is and ( case or switch ot tpl ) "+Array.from(h.attributes,(e=>e.name+"="+e.value+'"')).join(" "));if("["!=E&&""!=E&&(E+=","),c){const e=c.link.vorc.ct,n=m.document.getElementById(e);if(n)u="template"==h.nodeName.toLowerCase()?t:h,f="template"==n.nodeName.toLowerCase()?n.content.childNodes:[n],p=await oe(f,u,!0,i);else{const t=await(await fetch(e)).text(),n=(new DOMParser).parseFromString(t.trim(),"text/html");p=await oe(n.body.childNodes,u,!0,i)}}else u="template"==h.nodeName.toLowerCase()?h.content:h,f=u.childNodes,p=await oe(f,u,!0,i);if(a||l||o||s||i){b=ie(),d="",g="";const e=[];if(k=se(v),a&&({jsonAttr2:g,jsonAttr:d}=ne(a,b,s,g,d)),l&&({jsonAttr2:g,jsonAttr:d}=ne(l,b,s,g,d)),i){i.uid=b;const t=i.case;delete i.case,y="",t&&t.forEach((t=>{if(t.common&&(t.common.forEach((t=>e.push(t))),delete t.common),t.gen){const e=t.gen;delete t.gen,""!=y&&(y+=","),y+=te(t,null,e)}})),({jsonAttr2:g,jsonAttr:d}=ne(i,b,s,g,d,',"case":['+y+"]"))}c?"template"==h.nodeName.toLowerCase()?e.push({var:b,gen:p}):e.push({var:b,gen:ee(Q(h.nodeName,k,p),!0)}):e.push({var:b,gen:a?"null":ee(Q(h.nodeName,k,p),!0)}),o?(o.uid=b,o.gen=b,o.common=e,E+=ee(Q("#comment","["+JSON.stringify(b)+","+d+"]"),t)):s?(l||a||i?(s.uid=ie(),""!=d&&(d+=","),d+=te(s,s.uid),e.push({var:s.uid,gen:ee(Q("#comment","["+JSON.stringify(b)+","+g+"]"),!0)})):(s.uid=b,""!=d&&(d+=","),d+=te(s,b)),E+=ee(Q("#comment","["+JSON.stringify(s.uid)+","+d+"]"),t,e)):E+=ee(Q("#comment","["+JSON.stringify(b)+","+d+"]"),t,e)}else c&&"template"==h.nodeName.toLowerCase()?E+=p:E+=ee(Q(h.nodeName,se(v),p),t);break;case 3:{let e=!0;if(A.nodeValue&&(Y.setString(A.nodeValue),Y.check())){e=!1;const t=Y.getResult();t&&t.length&&t.forEach((e=>{"["!=E&&""!=E&&(E+=","),E+=Q(A.nodeName,"string"==typeof e?JSON.stringify(e):se([{type:0,prop:"textContent",link:e}]))}))}e&&("["!=E&&""!=E&&(E+=","),E+=Q(A.nodeName,JSON.stringify(A.nodeValue)))}break;case 6:"["!=E&&""!=E&&(E+=","),E+=Q(A.nodeName,JSON.stringify(A.nodeValue))}}return!1!==n&&(E+="]"),void 0===t?"(o)=>"+E:E}const le={GTpl:Z,GGenerator:w,GAddToo:x,jit:{GCompile:function(e,t){return new Function("g",`return ${e};`)(t||E)},GCode:async function(e){return oe("string"==typeof e?(new DOMParser).parseFromString(e.trim(),"text/html").body.childNodes:e instanceof Node?[e]:e)}},utils:{stack:c,css2obj:n,style2css:r,globalObject:m,passiveSupported:k,PROXYTARGET:u,ISPROXY:h}};return t.default})()));
//# sourceMappingURL=gtpl.min.js.map