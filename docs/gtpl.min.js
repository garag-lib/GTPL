/**
* gtpl v1.1.1
* (c) 2024 Manuel Peliz
* @license LGPL-2.1 license
* @repository https://github.com/garag-lib/GTPL
**/
!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.gtpl=e():t.gtpl=e()}(this,(()=>(()=>{"use strict";var t={95:(t,e,n)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.GParse=void 0;const i=n(109),s=["abstract","await","boolean","break","byte","case","catch","char","class","const","continue","debugger","default","delete","do","double","else","enum","export","extends","false","final","finally","float","for","function","goto","if","implements","import","in","instanceof","int","interface","let","long","native","new","null","package","private","protected","public","return","short","static","super","switch","synchronized","this","throw","throws","transient","true","try","typeof","var","void","volatile","while","with","yield","arguments","await","async","eval","undefined"];e.GParse=class{s;i;l;r;arr_acepted;ln;constructor(){this.setAceptedAN()}getResult(){return this.r}getSingleResult(){let t=null;return this.r&&1==this.r.length&&(t=this.r[0]),t}setString(t){this.s=t,this.l=t.length,this.i=0,this.r=[]}setAceptedAN(t="_"){this.arr_acepted=Array.from(t).map((t=>t.charCodeAt(0)))}checkStart(){return this.i+1<this.l&&"{"===this.s[this.i]&&"{"===this.s[this.i+1]}checkEnd(){return this.i+1<this.l&&"}"===this.s[this.i]&&"}"===this.s[this.i+1]}next(){return this.i++,!(this.i>=this.l)}nop(t=!1,e=null){let n=null;for(this.ln=null;;){if(n=this.s[this.i],e&&e.includes(n))return!0;let i=" "==n||"\t"==n||"\r"==n||"\n"==n;if(!i&&t&&(i='"'!=n&&"'"!=n&&!this.isAN(n),i&&(this.ln=n)),!i)return!0;if(!this.next())return!1}}isAN(t,e=!0){if(null==t)return!1;let n;for(let i=0,s=t.length,r=0;i<s;i++)if(r=t.charCodeAt(i),n=r>64&&r<91||r>96&&r<123||this.arr_acepted.indexOf(r)>=0,e&&(n=n||r>47&&r<58),!n)return!1;return!0}getVOrC(){let t=this.s[this.i];if('"'==t||"'"==t)return{ct:this.getConst()};if(this.isAN(t,!1))return{va:this.getVar()};if(this.isNumber(t)){const t=this.i,e=this.getNumber();if(null!==e)return{ct:e};this.i=t}return null}getVar(t=!0){let e,n=this.s[this.i],i=null;for(;;){if(!this.next())return""!=n?n.split("."):null;if(i=this.s[this.i],e=this.isAN(i),t&&!e&&(e="."==i),!e)return n.split(".");n+=i}}getConst(){const t=this.s[this.i];if(!this.next())return null;let e=this.s[this.i];if(e==t)return e="",this.next()?e:null;let n=null,i=null;for(;;){if(!this.next())return null;if(n=this.s[this.i],n==t&&"\\"!=i)return this.next()?e:null;e+=n,i=n}}isNumber(t){const e=t.charCodeAt(0);return e>=48&&e<=57}getNumber(){let t=this.s[this.i],e=null,n=!1;for(;this.next();){if(e=this.s[this.i],"."==e){if(n)return null;n=!0}else if(!this.isNumber(e))break;t+=e}return t}check(){let t,e,n,i=0,s="",r=!1;for(;;){if(this.checkStart()){if(r=!0,""!=s&&(this.r.push(s),s=""),t={},this.i+=2,i=this.i,!this.nop())return!1;if(e=this.getVOrC(),e){for(t.vorc=e;;){if(!this.nop())return!1;if(n=this.s[this.i],":"!=n)break;{if(!this.next())return!1;if(!this.nop())return!1;const i=this.getVar();if(null===i)return!1;t.functions||(t.functions=[]);const s={name:i};if(t.functions.push(s),!this.nop())return!1;if(n=this.s[this.i],"("==n){if(!this.next())return!1;if(!this.nop())return!1;if(n=this.s[this.i],null==n)break;if(")"==n){if(!this.next())return!1;continue}for(;;){if(e=this.getVOrC(),!e)return!1;if(s.params||(s.params=[]),s.params.push(e),!this.nop())return!1;if(n=this.s[this.i],null==n)break;if(","!=n){if(")"==n){if(!this.next())return!1;if(!this.nop())return!1;break}}else{if(!this.next())return!1;if(!this.nop())return!1}}}}}if(n=this.s[this.i],"{"==n){if(!this.next())return!1;for(;;){if(!this.nop())return!1;if(n=this.s[this.i],null==n)break;if("}"==n){if(!this.next())return!1;if(!this.nop())return!1;break}if(","!=n){if(e=this.getVOrC(),!e)return!1;t.params||(t.params=[]),t.params.push(e)}else if(!this.next())return!1}}if(n=this.s[this.i],";"==n){if(!this.next())return!1;if(!this.nop())return!1;const e=this.getVar(!1);if(null===e)return!1;if(!this.nop())return!1;if(n=this.s[this.i],";"!=n)return!1;{if(!this.next())return!1;if(!this.nop())return!1;const n=this.getVar(!1);if(null===n)return!1;t.index={index:e.join(""),target:n.join("")}}}if(!this.nop())return!1;if(this.checkEnd())this.i++,this.r.push(t);else if(!this.searchFormula(i))return!1}else if(!this.searchFormula(i))return!1}else s+=this.s[this.i];if(!this.next())break}return""!=s&&this.r.push(s),r}searchFormula(t){let e=this.s.substring(t,this.i);for(;;){if(this.checkEnd()){this.i++,this.r.push({formula:{code:e,vars:this.findVars(e)}}),e="";break}if(e+=this.s[this.i],!this.next())return!1}return!0}findVars(t){let e=t.trim();const n=this.s,r=this.i,o=this.l;this.s=e,this.l=e.length,this.i=0;let l=[],a=[[]];const h=t=>{a[a.length-1].push(t)},c=t=>a.some((e=>e.indexOf(t)>=0)),u=()=>{for(;this.i<this.l&&/\s/.test(this.s[this.i]);)this.i++},f=t=>{for(this.i++;this.i<this.l;)if("\\"===this.s[this.i])this.i+=2;else{if(this.s[this.i]===t){this.i++;break}this.i++}},p=()=>{for(this.i++;this.i<this.l;)if("\\"===this.s[this.i])this.i+=2;else if("$"===this.s[this.i]&&"{"===this.s[this.i+1]){this.i+=2;let t=1;const e=this.i;for(;this.i<this.l&&t>0;)"{"===this.s[this.i]?t++:"}"===this.s[this.i]&&t--,this.i++;const n=this.s.substring(e,this.i-1);this.findVars(n).forEach((t=>{c(t[0])||l.some((e=>e[0]===t[0]))||l.push(t)}))}else{if("`"===this.s[this.i]){this.i++;break}this.i++}},d=()=>{const t=this.i,e=this.getVOrC();if(e&&e.va){let n=t-1;for(;n>=0&&/\s/.test(this.s[n]);)n--;return n>=0&&"."===this.s[n]?null:e.va}return null},g=()=>{if("("!==this.s[this.i])return!1;const t=this.i;let e=0;for(;this.i<this.l;){const t=this.s[this.i];if("("===t)e++;else if(")"===t&&(e--,0===e))break;this.i++}const n=this.s.substring(t+1,this.i);return this.i++,u(),"=>"===this.s.substr(this.i,2)&&(n.split(",").forEach((t=>{const e=t.trim();e&&h(e)})),this.i+=2,!0)},m=()=>{if("catch"===this.s.substr(this.i,5)){if(this.i+=5,u(),"("===this.s[this.i]){this.i++,u();const t=d();for(t&&h(t[0]);this.i<this.l&&")"!==this.s[this.i];)this.i++;")"===this.s[this.i]&&this.i++}return!0}return!1},y=()=>{if("function"===this.s.substr(this.i,8)){this.i+=8,u();const t=d();if(t&&h(t[0]),u(),"("===this.s[this.i]){this.i++;let t="";for(;this.i<this.l&&")"!==this.s[this.i];)t+=this.s[this.i],this.i++;")"===this.s[this.i]&&this.i++,t.split(",").forEach((t=>{const e=t.trim();e&&h(e)}))}return!0}return!1},v=["const","var","let","function"];for(;this.i<this.l&&(u(),!(this.i>=this.l));){const t=this.s[this.i];if("catch"===this.s.substr(this.i,5)){m();continue}if("function"===this.s.substr(this.i,8)){y();continue}if("/"===t&&"/"===this.s[this.i+1]){for(this.i+=2;this.i<this.l&&"\n"!==this.s[this.i];)this.i++;continue}if("/"===t&&"*"===this.s[this.i+1]){for(this.i+=2;this.i<this.l&&("*"!==this.s[this.i]||"/"!==this.s[this.i+1]);)this.i++;this.i+=2;continue}if('"'===t||"'"===t){f(t);continue}if("`"===t){p();continue}if("{"===t){a.push([]),this.i++;continue}if("}"===t){a.pop(),this.i++;continue}if("("===t){const t=this.i;if(g())continue;this.i=t}const e=d();if(e){if(v.indexOf(e[0])>=0){u();const t=d();t&&h(t[0]);continue}if(void 0!==i.globalObject[e[0]])continue;if(s.indexOf(e[0])>=0)continue;let t=this.i;for(;t<this.l&&/\s/.test(this.s[t]);)t++;if(":"===this.s[t])continue;if(c(e[0]))continue;l.some((t=>t[0]===e[0]))||l.push(e)}else this.i++}return this.s=n,this.i=r,this.l=o,l}}},109:(t,e,n)=>{n.r(e),n.d(e,{globalObject:()=>r,passiveSupported:()=>l});let i=null;function s(t){return t&&t.Math===Math&&t}try{i=s("object"==typeof globalThis&&globalThis)||s("object"==typeof window&&window)||s("object"==typeof self&&self)||s("object"==typeof n.g&&n.g)||function(){return this}()||Function("return this")()}catch(t){}const r=i;let o=null;try{const t={get passive(){return o=!0,!1}};r.addEventListener("test",null,t),r.removeEventListener("test",null,t)}catch(t){o=!1}const l=o},139:(t,e,n)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.GCode=void 0;const i=n(95),s=n(175),r=n(109);let o,l=0,a=0;const h=/([a-zA-Z\_][\w]+)\s*\=\s*([a-zA-Z][\w\.]+)/gi;function c(t,e,n){return"g('"+t+"',"+(e||"null")+","+(n||"null")+",o)"}function u(t,e,n){if(n){let i=[];return n.forEach((t=>{i.push("const "+t.var+"="+t.gen+";")})),"((o)=>{"+i.join("")+"return "+t+"})"+(e?"":"(o)")}return"((o)=>"+t+")"+(e?"":"(o)")}function f(t,e,n,i){let s=g([t],!0);return s=s.substring(0,s.length-1),s=s+',"gen":'+(n||e)+(i||"")+"}",s}function p(t,e,n,i,s,r){return t.uid=e,n?(""!=i&&(i+=","),i+=f(t,e,void 0,r)):(""!=s&&(s+=","),s+=f(t,e,void 0,r)),{jsonAttr2:i,jsonAttr:s}}function d(t,e,n){let i=null;switch(e){case"g-is":i=i||12;case"g-binds":i=i||11;case"g-bind":i=i||10;case"g-attr":i=i||7;case"g-if":i=i||1;case"g-notif":i=i||2;case"g-switch":i=i||3;case"g-case":i=i||4;case"g-for":i=i||5;case"g-inner":if(i=i||9,o.setString(`{{${n}}}`),o.check()){const e={type:i,link:o.getSingleResult()};return 12===i?t.unshift(e):t.push(e),!0}break;case"g-var":if(i=i||15,n.match(h)){const e=n.split(h);return t.push({type:i,link:{svar:e[1],vorc:{va:e[2].split(".")}}}),!0}break;case"g-tpl":return i=i||14,t.push({type:i,link:{vorc:{ct:n}}}),!0;case"style":let r="";if(o.setString(n),o.check()){let e=o.getResult();if(e&&e.length){if(1==e.length)return t.push({type:8,prop:"cssText",link:e[0]}),!0;const i=(0,s.css2obj)(n);for(const[n,l]of Object.entries(i))o.setString(l),o.check()?(e=o.getSingleResult(),t.push({type:8,prop:n,link:e})):(r+=r?";":"",r+=`${(0,s.style2css)(n)}:${l}`);return""!=r&&t.push(["style",r]),!0}}break;default:if(o.setString(n),o.check()){const n=o.getResult();if(n&&1==n.length){const i={type:e.startsWith("on")?6:7,prop:e.startsWith("on")?e.substring(2):e,link:n[0]};return t.push(i),!0}}}return!1}function g(t,e=!1){const n=t.map((t=>{if(Array.isArray(t)||"string"==typeof t)return JSON.stringify(t);{const e=t;return e.link?.formula?`{${Object.entries(e).map((([t,e])=>"link"===t?`"${t}":{${Object.entries(e).map((([t,e])=>{if("formula"===t){const{vars:n,code:i}=e;if(null!=i){const e=n?.map((t=>t[0])).join(",")||"",s=i.match(/[\s;]await[\W]/gm)?" async ":"",r=`{${i}}`;return`"${t}":{"vars":${JSON.stringify(n)},"fnc":${s}function(${e})${r}}`}(0,s.log)("formula without code")}return`"${t}":${JSON.stringify(e)}`})).join(",")}}`:`"${t}":${JSON.stringify(e)}`)).join(",")}}`:JSON.stringify(t)}}));return e?n.join(","):`[${n.join(",")}]`}function m(){return l++,l>9999&&(a=1,a++),function(t){const e="abcdefghijklmnopqrstuvwxyz";let n="";return n+=e[Math.floor(t/26)],n+=e[t%26],n}(a)+String(l).padStart(4,"0")}async function y(t,e,n,s){null==o&&(o=new i.GParse);let l,a,h,v,k,b,E,w,A,x,C,R,P,O,S,T,j="";!1!==n&&(j="[");for(var N=0,G=t.length;N<G;N++){var V=t[N];switch(l=a=h=v=k=b=null,x=C=R=P=O="",V.nodeType){case 1:if("script"==V.nodeName.toLowerCase()){"["!=j&&(j+=","),j+=c(V.nodeName,JSON.stringify(V.textContent));continue}E=V,S=[];for(let t=0,e=E.attributes.length,n=E.attributes;t<e;t++){const e=n.item(t);if(e)if(d(S,e.name,e.value)){if(S.length){const t=S[S.length-1];if(t){if(12==t.type&&(k=t,S.pop()),1!=t.type&&2!=t.type||(v=t,S.pop()),5==t.type&&(l=t,S.pop()),3==t.type&&(a=t,S.pop()),4==t.type){if(!s)throw new Error("not switch");s.case||(s.case=[]),s.case.push(t),h=t,h.index=s.case.length-1,S.pop()}14==t.type&&(b=t,S.pop())}}}else S.push([e.name,e.value])}if(l&&h)throw new Error("not for and case "+Array.from(E.attributes,(t=>t.name+'="'+t.value+'"')).join(" "));if(v&&h)throw new Error("not if and case "+Array.from(E.attributes,(t=>t.name+'="'+t.value+'"')).join(" "));if(k&&(h||a||b))throw new Error("not is and ( case or switch ot tpl ) "+Array.from(E.attributes,(t=>t.name+"="+t.value+'"')).join(" "));if("["!=j&&""!=j&&(j+=","),b){const t=b.link.vorc.ct,n=r.globalObject.document.getElementById(t);if(n)w="template"==E.nodeName.toLowerCase()?e:E,A="template"==n.nodeName.toLowerCase()?n.content.childNodes:[n],x=await y(A,w,!0,a);else{const e=await(await fetch(t)).text(),n=(new DOMParser).parseFromString(e.trim(),"text/html");x=await y(n.body.childNodes,w,!0,a)}}else w="template"==E.nodeName.toLowerCase()?E.content:E,A=w.childNodes,x=await y(A,w,!0,a);if(k||v||h||l||a){T=m(),C="",R="";const t=[];if(O=g(S),k&&({jsonAttr2:R,jsonAttr:C}=p(k,T,l,R,C)),v&&({jsonAttr2:R,jsonAttr:C}=p(v,T,l,R,C)),a){a.uid=T;const e=a.case;delete a.case,P="",e&&e.forEach((e=>{if(e.common&&(e.common.forEach((e=>t.push(e))),delete e.common),e.gen){const t=e.gen;delete e.gen,""!=P&&(P+=","),P+=f(e,null,t)}})),({jsonAttr2:R,jsonAttr:C}=p(a,T,l,R,C,',"case":['+P+"]"))}b?"template"==E.nodeName.toLowerCase()?t.push({var:T,gen:x}):t.push({var:T,gen:u(c(E.nodeName,O,x),!0)}):t.push({var:T,gen:k?"null":u(c(E.nodeName,O,x),!0)}),h?(h.uid=T,h.gen=T,h.common=t,j+=u(c("#comment","["+JSON.stringify(T)+","+C+"]"),e)):l?(v||k||a?(l.uid=m(),""!=C&&(C+=","),C+=f(l,l.uid),t.push({var:l.uid,gen:u(c("#comment","["+JSON.stringify(T)+","+R+"]"),!0)})):(l.uid=T,""!=C&&(C+=","),C+=f(l,T)),j+=u(c("#comment","["+JSON.stringify(l.uid)+","+C+"]"),e,t)):j+=u(c("#comment","["+JSON.stringify(T)+","+C+"]"),e,t)}else b&&"template"==E.nodeName.toLowerCase()?j+=x:j+=u(c(E.nodeName,g(S),x),e);break;case 3:{let t=!0;if(V.nodeValue&&(o.setString(V.nodeValue),o.check())){t=!1;const e=o.getResult();e&&e.length&&e.forEach((t=>{"["!=j&&""!=j&&(j+=","),j+=c(V.nodeName,"string"==typeof t?JSON.stringify(t):g([{type:0,prop:"textContent",link:t}]))}))}t&&("["!=j&&""!=j&&(j+=","),j+=c(V.nodeName,JSON.stringify(V.nodeValue)))}break;case 6:"["!=j&&""!=j&&(j+=","),j+=c(V.nodeName,JSON.stringify(V.nodeValue))}}return!1!==n&&(j+="]"),void 0===e?"(o)=>"+j:j}e.GCode=async function(t){return y("string"==typeof t?(new DOMParser).parseFromString(t.trim(),"text/html").body.childNodes:t instanceof Node?[t]:t)}},175:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.STACK=e.log=e.isStaticType=e.style2css=e.css2obj=void 0,e.css2obj=function(t){const e={},n=t.toLowerCase().replace(/-(.)/g,((t,e)=>e.toUpperCase())).replace(/;\s?$/g,"").split(/:|;/g);for(let t=0,i=n.length;t<i;t+=2)e[n[t].replace(/\s/g,"")]=n[t+1].replace(/^\s+|\s+$/g,"");return e},e.style2css=function(t){return t.replace(/([a-z])([A-Z])/g,"$1-$2").toLocaleLowerCase()};const n=["symbol","bigint","undefined","boolean","string","number"];function i(...t){console.log("%c----------","font-weight:bold"),t.forEach((t=>{console.log(t)})),console.log("%c----------","font-weight:bold")}e.isStaticType=function(t){if(null==t)return!0;const e=typeof t;return n.includes(e)},e.log=i,e.STACK=function(...t){t.push(new Error(t.shift()).stack),i(...t)}},330:(t,e,n)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.iterPath=e.pathToString=e.pathToArray=e.GProxy=e.PROXYTARGET=e.ISPROXY=void 0;const i=n(175);function s(t,e=[]){return t.forEach((function(t){Array.isArray(t)?s(t,e):e.push(t)})),e}e.ISPROXY=Symbol("is proxy"),e.PROXYTARGET=Symbol("proxy target"),e.GProxy=function t(n,s,r,o){return new Proxy(n,function(n,s,r){return{get:(o,l,a)=>{if(l==e.ISPROXY)return!0;if(l==e.PROXYTARGET)return o;const h=Reflect.get(o,l,a);return(0,i.isStaticType)(h)||h[e.ISPROXY]?h:t(h,n,s,[r,l])},set:(t,o,l)=>{if(!(0,i.isStaticType)(l))for(;l[e.ISPROXY];)l=l[e.PROXYTARGET];const a=Reflect.set(t,o,l);return n(0,[r,o],l,s),a},deleteProperty:(t,e)=>{const i=Reflect.deleteProperty(t,e);return n(1,[r,e],void 0,s),i}}}(s,r,o))},e.pathToArray=s,e.pathToString=function(t,e=[]){return s(t,e).join(".")},e.iterPath=function*t(e){for(let n=0,i=e.length;n<i;n++){const i=e[n];Array.isArray(i)?yield*t(i):yield i}}},462:(t,e,n)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.GTpl=void 0;const i=n(330),s=n(651),r=n(109),o=n(175),l={binitChangeEvents:!1};class a{static globalVar=new WeakMap;static init(t){a.globalVar.has(t)||a.globalVar.set(t,{GenerationFinish:!1,MarkEle:new WeakMap,memValues:new WeakMap,renderElements:new Set})}static getProperty(t,e){return a.init(t),a.globalVar.get(t)[e]}static setProperty(t,e,n){a.init(t),a.globalVar.get(t)[e]=n}}const h=new WeakMap;function c(t,e){const n=a.getProperty(t,"renderElements");n.has(e)||n.add(e)}function u(t,e,n,i=!1){if(t.length>1){const s=(e,n,i)=>n==i?e[t[n]]:s(e[t[n]],++n,i),r=s(e.Root,0,t.length-2),o=t[t.length-1];(i||r[o]!=n)&&(r[o]=n)}else{const s=t[0];(i||e.Root[s]!=n)&&(e.Root[s]=n)}}function f(t,e,n,i,s){if(null==i&&(i=0),void 0!==s&&i>=e.length-s)return n;const r=null==n?t.getValue(e[i++]):n[e[i++]];return void 0!==s&&i>=e.length-s||i>=e.length?r:f(t,e,r,i)}async function p(t,e,n,i){null==n&&(n=0);const s=e[n],r=t.getContext(s.name[0]),l=f(r,s.name);if(l){const e=[];s.params&&s.params.forEach((n=>{null!=n.ct?e.push(n.ct):null!=n.va&&e.push(f(t,n.va))})),null!=i&&e.push(i),i=await l.apply(r.Root,e)}else(0,o.STACK)("fnc undefined",n,e);return++n>=e.length?i:await p(t,e,n,i)}async function d(t,e,n,i){let s;const r=e.gtpl?e.gtpl:t;if(e.link.formula&&e.link.formula.fnc){const t=e.link.formula.fnc,n=[];e.link.formula.vars&&e.link.formula.vars.forEach((t=>{n.push(r.getValue(t[0]))})),i&&n.push(i),s=await t.apply(r.Root,n)}else e.link.vorc&&(null!=e.link.vorc.va&&(s=null!=n?n:f(r,e.link.vorc.va)),null!=e.link.vorc.ct&&(s=e.link.vorc.ct)),e.link.functions&&(s=await p(r,e.link.functions,0,s));return s}function g(t,e){let n=t;if(e.link.vorc&&e.link.vorc.va)n=t.getContext(e.link.vorc.va[0]);else if(e.link.functions){const i=e.link.functions[0];n=t.getContext(i.name[0])}return n}function m(t,e,n){const s=e[0];if(null!=t.BindTree[s])return;const r={key:s,val:t.getValue(s),pro:void 0};t.BindDef.add(r);try{t.Root.hasOwnProperty(s)||(t.Root[s]=null),Object.defineProperty(t.Root,s,{get:function(){if(void 0!==r.pro)return r.pro;if((0,o.isStaticType)(r.val))return r.val;for(;r.val[i.ISPROXY];)r.val=r.val[i.PROXYTARGET];return r.pro=(0,i.GProxy)(r.val,t.eventPRoxy.bind(t),r,[r.key]),r.pro},set:function(e){if(r.val=e,(0,o.isStaticType)(e))return delete r.pro,t.eventPRoxy(0,[r.key],e,r),r.val;for(;r.val[i.ISPROXY];)r.val=r.val[i.PROXYTARGET];return r.pro=(0,i.GProxy)(r.val,t.eventPRoxy.bind(t),r,[r.key]),t.eventPRoxy(0,[r.key],e,r),r.pro}})}catch(e){(0,o.STACK)(e.message,s,t.Root)}}function y(t,e,n){let i=t.BindTree;for(let s=0,r=e.length;s<r;s++){const o=e[s];if(0==s){const i=t.getContext(o);if(m(i,e),i!=t)return n.gtpl=t,t.BindMap||(t.BindMap=new Map),t.BindMap.set(n,i),void y(i,e,n)}null==i[o]&&(i[o]={}),s<r-1?(i=i[o],null==i.tree&&(i.tree={}),i=i.tree):i=i[o]}null==i.me&&(i.me=new Set),i.me.add(n)}function v(t,e,n){let i=t.BindTree;for(let t=0,n=e.length;t<n;t++){const s=e[t];t<n-1?(i=i[s],i=i.tree):i=i[s]}return i.me}function k(t,e){e.link.vorc&&e.link.vorc.va&&v(t,e.link.vorc.va).delete(e),e.link.formula?.vars&&e.link.formula.vars.forEach((n=>{v(t,n).delete(e)}))}function b(t,e){let n=!1;if(e.link.vorc&&e.link.vorc.va&&v(t,e.link.vorc.va).has(e)&&(n=!0),e.link.formula?.vars&&e.link.formula.vars.forEach((i=>{v(t,i).has(e)&&(n=!0)})),!n){const n=a.getProperty(t,"renderElements");n.has(e)&&n.delete(e)}return n}function E(t){Array.isArray(t)?t.forEach((t=>{t.destroy?t.destroy(!0):E(t)})):t.destroy?t.destroy(!0):t.parentNode?.removeChild(t)}function w(t,e,n,i,s=[]){if(t&&(t.me&&t.me.forEach((t=>{s.push([e,t,n,n.length?void 0:i])})),t.tree)){const r=Array.isArray(n)?n.shift():void 0;for(let o in t.tree)null!=r&&r!=o||w(t.tree[o],e,n,null!=i?null==r?i[o]:i:void 0,s)}return s}function A(t,e,n){if(n){const n=a.getProperty(t,"MarkEle"),i=a.getProperty(t,"memValues");e.ele?n.has(e.mark)&&e.ele!=n.get(e.mark)&&(e.ele=n.get(e.mark),i.delete(e)):e.mark&&(e.gen?(n.has(e.mark)?e.ele=n.get(e.mark):(e.ele=e.gen(e.gtpl?e.gtpl:t),n.set(e.mark,e.ele)),delete e.gen):n.has(e.mark)&&(e.ele=n.get(e.mark),i.delete(e)))}}function x(t,e=!0){t.ele&&(Array.isArray(t.ele)?t.ele.forEach((e=>{t.mark.parentNode.insertBefore(e,t.mark)})):t.mark.parentNode.insertBefore(t.ele,t.mark),e&&t.mark.remove())}function C(t,e=!0){t.ele&&(Array.isArray(t.ele)?(e&&t.ele[0].parentNode.insertBefore(t.mark,t.ele[0]),t.ele.forEach((t=>{t.remove()}))):(e&&t.ele.parentNode.insertBefore(t.mark,t.ele),t.ele.remove()))}function R(t,e,n){const i=P(t,e),s=function(t){let e=!0;if(t.mark.checks)for(let n in t.mark.checks)if(!t.mark.checks[n]){e=!1;break}return e}(e);return n&&s?(i>=0&&(t.RenderElements[i]=e),e.mark.parentNode?x(e):i>=0&&b(t,e)&&c(t,e)):(i>=0&&delete t.RenderElements[i],e.ele.parentNode?C(e):i>=0&&b(t,e)&&c(t,e)),!(n&&!s)}function P(t,e){const n=t.Elements.indexOf(e.mark);return n>=0&&(t.RenderElements||(t.RenderElements={})),n}function O(t,e,n,i,s,r){const o={parent:e.gtpl?e.gtpl:t,generator:e.gen};if(n&&i&&s){const t={};t[n.index]=i.length,t[n.target]=s,o.context=[n.index,n.target],o.root=t}return void 0!==r&&(o.refresh=r),new S(o)}class S{ID;FncElements;Elements;RenderElements;BindTree;BindConst;BindMap;BindDef;GtplChilds;Parent;Context;Root;constructor(t){this.ID=Math.random().toString(16).slice(2),this.BindTree={},this.BindConst=new Set,this.BindDef=new Set,this.GtplChilds=new Set,this.loadOptions(t)}loadOptions(t){t&&(this.Root=t.root,t.parent&&(this.Parent=t.parent),t.context&&(this.Context=new Set(t.context)),t.generator&&(this.FncElements=t.generator,this.Elements=[],(0,s.GAddToo)(this.Elements,this.FncElements,this)),a.setProperty(this,"GenerationFinish",!0),void 0!==t.refresh&&!0!==t.refresh||this.refresh())}getValue(t){const e=this.Root;if(e){if(e.hasOwnProperty(t))return e[t];if(void 0!==e[t])return e[t]}if(this.Parent)return this.Parent.getValue(t)}getGtplRoot(){return this.Parent?this.Parent.getGtplRoot():this}getRoot(){return this.Parent?this.Parent.getRoot():this.Root}getContext(t){return this.Context&&this.Context.has(t)?this:this.Parent?this.Parent.getContext(t):this.getGtplRoot()}addBind(t){(function(t,e){if(15==e.type){if(e.link.svar&&e.link.vorc&&e.link.vorc.va){const n=e.link.vorc.va.join("");e.ele[e.link.svar]="this"==n?t.Root:f(t,e.link.vorc.va)}return!0}return!1})(this,t)||function(t,e){if(6==e.type&&e.prop){const n={gtpl:g(t,e),bind:e},i={passive:!1};return["wheel","mousewheel","touchstart","touchmove"].includes(e.prop.toLowerCase())&&(i.passive=!0),e.ele.addEventListener(e.prop,(async function(e){const i=await d(n.gtpl,n.bind,void 0,e);if("function"==typeof i)if(n.bind.link.params){const s=[];n.bind.link.params.forEach((e=>{null!=e.ct?s.push(e.ct):null!=e.va&&s.push(f(t,e.va))})),i.apply(n.gtpl.Root,[e,...s])}else i.apply(n.gtpl.Root,[e]);else e.preventDefault&&e.preventDefault()}),!!r.passiveSupported&&i),!0}return!1}(this,t)||function(t,e){let n=!1;return e.link.formula&&e.link.formula.vars&&e.link.formula.vars.length&&(n=!0,e.link.formula.vars.forEach((n=>{y(t,n,e)}))),n}(this,t)||function(t,e){let n=!1;return e.link.vorc&&e.link.vorc.va&&(n=!0,function(t,e){if(7==e.type&&e.prop&&e.link&&e.link.vorc&&e.link.vorc.va){const{prop:n}=e;if(n.startsWith("[")&&n.endsWith("]")){!function(){if(!l.binitChangeEvents)try{l.binitChangeEvents=!0;const t=function(t){const e=t.target;if(h.has(e)){const t=h.get(e);if(t)for(let n of t)u(n.va,n.ctx,e.value)}};r.globalObject.addEventListener&&(r.globalObject.addEventListener("input",t),r.globalObject.addEventListener("change",t))}catch(t){(0,o.STACK)(t.message)}}(),e.simetric=!0,e.prop=n.slice(1,-1);const i=e.link.vorc.va,s=t.getContext(i[0]);if("value"==e.prop&&(h.has(e.ele)||h.set(e.ele,new Set),h.get(e.ele)?.add({va:i,ctx:s})),e.prop in e.ele.constructor.prototype){const t=Object.getOwnPropertyDescriptor(e.ele.constructor.prototype,e.prop);t?Object.defineProperty(e.ele,e.prop,{get:function(){return t.get.call(this)},set:function(n){if("value"==e.prop&&"select"==e.ele.nodeName.toLowerCase()){const e=t.set.call(this,n);return t.get.call(this)==n?u(i,s,n):(0,o.log)("select value not valid",n+" not in options"),e}return u(i,s,n),t.set.call(this,n)}}):(0,o.log)("simetric attr error",e.prop," not in ",e.ele.constructor.prototype)}else(0,o.log)("simetric attr error",e.prop," in ",e.ele)}}}(t,e),y(t,e.link.vorc.va,e)),e.link.functions&&e.link.functions.forEach((i=>{i.params&&i.params.forEach((i=>{i.va&&(n=!0,y(t,i.va,e))}))})),n}(this,t)||this.BindConst.add(t),a.getProperty(this,"GenerationFinish")&&this.launchChange(3,t)}destroy(t=!0){const e=Array.isArray(this.Elements)?this.Elements.length:1;if(this.GtplChilds.forEach((t=>{t.destroy(!1)})),this.BindMap)for(let[t,e]of this.BindMap)k(e,t);if(t&&(E(this.Elements),this.RenderElements)){for(let t=0;t<e;t++)if(this.RenderElements[t]){const e=this.RenderElements[t];e.ele?E(e.ele):e.eles&&E(e.eles)}delete this.RenderElements}}refresh(){for(let t of this.BindDef)this.eventPRoxy(4,[],void 0,t);if(this.BindMap)for(let[t,e]of this.BindMap)e.launchChange(5,t);if(this.BindConst)for(let t of this.BindConst)this.launchChange(6,t)}addTo(t){if(this.RenderElements){const e=[];(Array.isArray(this.Elements)?this.Elements:[this.Elements]).forEach(((t,n)=>{if(this.RenderElements[n]){const t=this.RenderElements[n];t.ele?e.push(t.ele):t.eles&&(t.eles.forEach((t=>t.addTo(e))),e.push(t.mark))}else e.push(t)})),(0,s.GAddToo)(t,e,this)}else(0,s.GAddToo)(t,this.Elements,this)}eventPRoxy(t,e,n,s){const r=(0,i.pathToArray)(e);r?.shift(),w(this.BindTree[s.key],t,r,n).forEach((t=>this.launchChange.apply(this,t)))}async launchChange(t,e,n,i){if(6==e.type)return;const s=await d(this,e,i);let r=this;switch(e.type){case 0:r=await async function(t,e,n,i){e=g(e,n);const s=a.getProperty(e,"memValues");if(null!=i){if(s.has(n)&&s.get(n)==i)return e;s.set(n,i)}return n.ele.textContent=i,e}(0,this,e,s);break;case 7:r=await async function(t,e,n,i){e=g(e,n);const s=(t,e)=>{if(void 0!==n.ele[t]&&null!==n.ele[t]){if(null==e)""!==n.ele[t]&&(n.ele[t]=null);else if(n.ele[t]!=e)try{n.ele[t]=e}catch(e){(0,o.STACK)(e.message,n.ele,t)}}else null==e?n.ele.removeAttribute(t):n.ele.getAttribute(t)!=e&&n.ele.setAttribute(t,e)};if(n.prop)s(n.prop,i);else if(null==i)n.attrs&&(n.attrs.forEach((t=>{s(t,null)})),delete n.attrs);else{n.attrs||(n.attrs=[]),n.attrs.filter((t=>!(t in i))).forEach((t=>{s(t,null)})),n.attrs.length=0;for(let t in i)n.attrs.push(t),s(t,i[t])}return e}(0,this,e,s);break;case 9:r=await async function(t,e,n,i){return e=g(e,n),void 0!==i&&n.ele.innerHTML!=i&&(n.ele.innerHTML=i),e}(0,this,e,s);break;case 8:r=await async function(t,e,n,i){e=g(e,n);const s=a.getProperty(e,"memValues");return s.has(n)&&s.get(n)==i||(s.set(n,i),n.prop&&(console.log(n),n.ele.style[n.prop]=i)),e}(0,this,e,s);break;case 1:case 2:r=await async function(t,e,n,i){e=g(e,n);const s=2==n.type?!i:!!i;if(n.mark.checks||(n.mark.checks={}),n.mark.checks[n.type]=s,A(e,n,s),!n.ele)return e;const r=a.getProperty(e,"memValues");return r.has(n)&&r.get(n)===s||R(e,n,s)&&r.set(n,s),e}(0,this,e,s);break;case 5:r=await async function(t,e,n,i,s){e=g(e,n),n.eles||(n.eles=[]);const r=n.eles,o=n.link.index,l=[],a=[],h=Array.isArray(s)&&s.length?s[0]:void 0;if(isNaN(h))if(i&&i.length){if("length"==h&&r.length==i.length)return e;i.forEach(((t,i)=>{if(i>=r.length){const s=O(e,n,o,r,t,!1);r.push(s),l.push([s,i])}else r[i].Root[o.target]=t})),r.length>i.length&&r.splice(i.length,r.length-i.length).forEach(((t,e)=>{a.push([t,e])}))}else r.length&&(r.forEach(((t,e)=>{a.push([t,e])})),r.length=0);else{const c=s;if(0==t){let t=!1;if(c.length>1)t=!0;else if(1==c.length&&r.length==i.length)return r[h].Root[o.target]=i[h],e;if(t){const t=r[h];c.shift(),u(c,{Root:t.Root[o.target]},f(e,c,i[h]),!0)}else{const t=O(e,n,o,r,i[h],!1);r.push(t),l.push([t,h])}}if(1==t)if(c.length>1)r[h].Root[o.target]=i[h];else{const t=r.splice(h,1)[0];a.push([t,h])}}if(a.length&&a.forEach((t=>{const[n,i]=t;n.destroy(),e.GtplChilds.delete(n)})),l.length){const t=P(e,n);t>=0&&(e.RenderElements[t]||(e.RenderElements[t]=n));const i=[];l.forEach((t=>{const[n,s]=t;n.addTo(i),e.GtplChilds.add(n)})),n.mark.parentNode?(x({type:n.type,link:n.link,ele:i,mark:n.mark},!1),l.forEach((t=>{t[0].refresh()}))):t>=0&&b(e,n)&&c(e,n)}return e}(t,this,e,s,n);break;case 3:r=await async function(t,e,n,i){e=g(e,n);const s=null!=i;if(n.mark.checks||(n.mark.checks={}),n.mark.checks[n.type]=s,A(e,n,s),n.mark.checks||(n.mark.checks={}),n.mark.checks[n.type]=null!=i,!n.ele)return e;const r=a.getProperty(e,"memValues");if(r.has(n)&&r.get(n)===i)return e;if(r.set(n,i),n.case&&n.case.length){if(n.eles&&n.eles.length&&(n.eles.forEach((t=>{C(t.refCase),t.destroy(),e.GtplChilds.delete(t)})),delete n.eles),!b(e,n))return e;if(s){if(!n.case[0].mark){const t={};for(let e=0,i=n.ele.childNodes.length;e<i;e++){const i=n.ele.childNodes[e];8===i.nodeType&&6==i.textContent.length&&(t[i.textContent]=i)}for(let e=0,i=n.case.length;e<i;e++){const i=n.case[e];!i.mark&&i.uid&&(i.mark=t[i.uid])}}for(let t=0,s=n.case.length;t<s;t++){const s=n.case[t];if(await d(e,s)==i){const t=O(e,s,void 0,void 0,void 0,!1);s.ele=t.Elements,s.eles=[t],t.refCase=s,e.GtplChilds.add(t),n.eles=s.eles;break}}}}return R(e,n,s)&&s&&(n.eles[0].refresh(),x(n.eles[0].refCase)),e}(0,this,e,s);break;case 12:r=await async function(t,e,n,i){e=g(e,n);const s=null!=i,r=a.getProperty(e,"memValues");if(r.has(n)&&r.get(n)==i)return e;r.set(n,i);let o=!1;if(n.eles?(o=!0,n.eles[0].destroy(),e.GtplChilds.delete(n.eles[0]),delete n.eles):n.ele&&C(n),!s)return e;if(o&&!b(e,n))return e;if(Array.isArray(i)||"function"==typeof i){const t=O(e,{link:n.link,type:n.type,gtpl:n.gtpl,gen:i});n.eles=[t],e.GtplChilds.add(t),n.ele=t.Elements}else n.ele=i;return a.getProperty(e,"MarkEle").set(n.mark,n.ele),R(e,n,s),e}(0,this,e,s)}!function(t,e){const n=a.getProperty(t,"renderElements");n.has(e)&&(Array.isArray(t.Elements)?t.Elements:[t.Elements]).forEach(((e,i)=>{const s=t.RenderElements[i];if(s&&n.has(s)){let t=!0;if(s.ele){const e=Array.isArray(s.ele)?s.ele[0]:s.ele;s.mark.parentNode||e.parentNode?s.mark.parentNode&&!e.parentNode&&(x(s),s.eles&&(s.eles[0].refresh(),s.eles[0].refCase&&x(s.eles[0].refCase))):t=!1}else if(s.eles)if(s.mark.parentNode){let t=null;const e=[];s.eles.forEach((n=>{const i=[];n.refresh(),n.addTo(i),i.forEach((n=>{n.parentNode?t||(t=n):e.push(n)}))})),e.length&&x({type:s.type,link:s.link,ele:e,mark:t||s.mark},!1)}else t=!1;t&&n.delete(s)}}))}(r,e)}}e.GTpl=S},651:(t,e,n)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.GCompile=e.GAddToo=e.GGenerator=void 0;const i=n(109);function s(t,e,n){return n&&(t.mark=n),e&&(t.ele=e),t}function r(t,e,n){Array.isArray(e)?e.forEach((e=>{r(t,e,n)})):"function"==typeof e?r(t,e(n),n):null!=e&&(Array.isArray(t)?t.push(e):t.appendChild(e))}function o(t,e,n,o){let l=null;switch(t){case"#text":null==l&&(l=i.globalObject.document.createTextNode("")),"string"==typeof e&&(l.textContent=e);case"#comment":return null==l&&(l=i.globalObject.document.createComment("")),"string"==typeof e?l.textContent=e:e.forEach((t=>{"string"!=typeof t?Array.isArray(t)?console.error(l,t):0==t.type?o.addBind(s(t,l)):o.addBind(s(t,void 0,l)):l.textContent=t})),l;default:const a=i.globalObject.document.createElement(t);return r(a,n,o),Array.isArray(e)&&e.forEach((t=>{if(Array.isArray(t))a.setAttribute(t[0],t[1]);else{const e=t;o.addBind(s(e,a))}})),a}}e.GGenerator=o,e.GAddToo=r,e.GCompile=function(t,e){return new Function("g",`return ${t};`)(e||o)}}},e={};function n(i){var s=e[i];if(void 0!==s)return s.exports;var r=e[i]={exports:{}};return t[i](r,r.exports,n),r.exports}n.d=(t,e)=>{for(var i in e)n.o(e,i)&&!n.o(t,i)&&Object.defineProperty(t,i,{enumerable:!0,get:e[i]})},n.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"==typeof window)return window}}(),n.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),n.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})};var i={};return(()=>{var t=i;const e=n(462),s=n(651),r=n(175),o=n(139),l=n(109),a=n(330);t.default={GTpl:e.GTpl,GGenerator:s.GGenerator,GAddToo:s.GAddToo,jit:{GCompile:s.GCompile,GCode:o.GCode},utils:{stack:r.STACK,css2obj:r.css2obj,style2css:r.style2css,globalObject:l.globalObject,passiveSupported:l.passiveSupported,PROXYTARGET:a.PROXYTARGET,ISPROXY:a.ISPROXY}}})(),i.default})()));
//# sourceMappingURL=gtpl.min.js.map