/*!
* gtpl v1.1.1
* (c) 2024 Manuel Peliz
* @license LGPL-2.1 license
* @repository https://github.com/garag-lib/GTPL
*/
var gtpl=function(){"use strict";function t(t){const e={},n=t.toLowerCase().replace(/-(.)/g,(t,e)=>e.toUpperCase()).replace(/;\s?$/g,"").split(/:|;/g);for(let t=0,i=n.length;t<i;t+=2)e[n[t].replace(/\s/g,"")]=n[t+1].replace(/^\s+|\s+$/g,"");return e}function e(t){return t.replace(/([a-z])([A-Z])/g,"$1-$2").toLocaleLowerCase()}const n=["symbol","bigint","undefined","boolean","string","number"];function i(t){if(null==t)return!0;const e=typeof t;return n.includes(e)}function s(...t){console.log("%c----------","font-weight:bold"),t.forEach(t=>{console.log(t)}),console.log("%c----------","font-weight:bold")}function r(...t){t.push(new Error(t.shift()).stack),s(...t)}const o=Symbol("is proxy"),l=Symbol("proxy target"),a=new WeakMap,h=new WeakMap;function c(t){return!!t&&"object"==typeof t&&o in t}function u(t,e,n,s=[]){if(i(t))return t;const r=a.get(t);if(r)return h.get(t).add(e),r.proxy;const f=function(t,e,n=[],s){return{get(r,a,h){if(a===o)return!0;if(a===l)return t;if(a===Symbol.iterator){const t=r[Symbol.iterator].bind(r);return function*(){for(const r of t())yield i(r)||c(r)?r:u(r,s,e,[...n,Symbol.iterator])}}const f=Reflect.get(r,a,h);return i(f)||c(f)?f:u(f,s,e,[...n,a])},set(i,s,r,o){c(r)&&(r=r[l]);const a=Reflect.set(i,s,r,o),u=h.get(t);return u?.forEach(t=>t(0,[...n,s],r,e)),a},deleteProperty(i,s){const r=Reflect.deleteProperty(i,s),o=h.get(t);return o?.forEach(t=>t(1,[...n,s],void 0,e)),r},has:(t,e)=>Reflect.has(t,e),ownKeys:t=>Reflect.ownKeys(t),getOwnPropertyDescriptor:(t,e)=>Reflect.getOwnPropertyDescriptor(t,e)}}(t,n,s,e),{proxy:p,revoke:d}=Proxy.revocable(t,f);return a.set(t,{proxy:p,revoke:d}),h.set(t,new Set([e])),p}const f=u;function p(t,e){c(t)&&(t=t[l]);const n=h.get(t);if(n&&(n.delete(e),0===n.size)){h.delete(t);const e=a.get(t);if(e){try{e.revoke()}catch(t){console.error("[GProxy] Error revoking proxy:",t)}a.delete(t)}}}let d=null;function g(t){return t&&t.Math===Math&&t}try{d=g("object"==typeof globalThis&&globalThis)||g("object"==typeof window&&window)||g("object"==typeof self&&self)||g("object"==typeof global&&global)||function(){return this}()||Function("return this")()}catch(t){}const m=d;let y=null;try{const t={get passive(){return y=!0,!1}};m.addEventListener("test",null,t),m.removeEventListener("test",null,t)}catch(t){y=!1}const k=y,v=new Map;const b=new WeakMap;function E(t,e,n){return n&&(t.mark=n),e&&(t.ele=e),t}function w(t,e,n){Array.isArray(e)?e.forEach(e=>{w(t,e,n)}):"function"==typeof e?w(t,e(n),n):null!=e&&(Array.isArray(t)?t.push(e):t.appendChild(e))}function C(t,e,n,i){let s=null;switch(t){case"#text":null==s&&(s=m.document.createTextNode("")),"string"==typeof e&&(s.textContent=e);case"#comment":return null==s&&(s=m.document.createComment("")),"string"==typeof e?s.textContent=e:e.forEach(t=>{"string"!=typeof t?Array.isArray(t)?console.error(s,t):0==t.type?i.addBind(E(t,s)):i.addBind(E(t,void 0,s)):s.textContent=t}),s;default:const r=m.document.createElement(t);return w(r,n,i),Array.isArray(e)&&e.forEach(t=>{if(Array.isArray(t))v.has(t[0])&&function(t,e,n,i){const s=v.get(e);if(!s)return!1;const r=new s(t,n,i);let o=b.get(t);o||(o=[],b.set(t,o)),o.push(r)}(r,t[0],t[1],i)||r.setAttribute(t[0],t[1]);else{const e=t;i.addBind(E(e,r))}}),r}}const x=C,A=w,R=function(t,e){return new Function("g",`return ${t};`)(e||C)},N=function(t,e){return!v.has(t)&&(v.set(t,e),!0)},P=Symbol("ElementReferenceIndex"),S={binitChangeEvents:!1};class B{static globalVar=new WeakMap;static init(t){B.globalVar.has(t)||B.globalVar.set(t,{GenerationFinish:!1,MarkEle:new WeakMap,memValues:new WeakMap,renderElements:new Set})}static getProperty(t,e){B.init(t);return B.globalVar.get(t)[e]}static setProperty(t,e,n){B.init(t);B.globalVar.get(t)[e]=n}}const O=new WeakMap;function j(t,e){const n=B.getProperty(t,"renderElements");n.has(e)||n.add(e)}function V(t,e,n,i=!1){if(t.length>1){const s=(e,n,i)=>n==i?e[t[n]]:s(e[t[n]],++n,i),r=s(e.Root,0,t.length-2),o=t[t.length-1];(i||r[o]!=n)&&(r[o]=n)}else{const s=t[0];(i||e.Root[s]!=n)&&(e.Root[s]=n)}}function G(t,e,n,i,s){null==i&&(i=0);const r=null==n?t.getValue(e[i++]):n[e[i++]];return i>=e.length?r:G(t,e,r,i)}async function M(t,e,n,i){null==n&&(n=0);const s=e[n],o=t.getContext(s.name[0]),l=G(o,s.name);if(l){const e=[];s.params&&s.params.forEach(n=>{null!=n.ct?e.push(n.ct):null!=n.va&&e.push(G(t,n.va))}),null!=i&&e.push(i),i=await l.apply(o.Root,e)}else r("fnc undefined",n,e);return++n>=e.length?i:await M(t,e,n,i)}async function D(t,e,n,i){let s;const r=e.gtpl?e.gtpl:t;if(e.link.formula&&e.link.formula.fnc){const t=e.link.formula.fnc,n=[];if(e.link.formula.vars){e.link.formula.vars.forEach(t=>{n.push(r.getValue(t[0]))})}i&&n.push(i),s=await t.apply(r.Root,n)}else e.link.vorc&&(null!=e.link.vorc.va&&(s=null!=n?n:G(r,e.link.vorc.va)),null!=e.link.vorc.ct&&(s=e.link.vorc.ct)),e.link.functions&&(s=await M(r,e.link.functions,0,s));return s}function T(t,e){let n=t;if(e.link.vorc&&e.link.vorc.va)n=t.getContext(e.link.vorc.va[0]);else if(e.link.functions){const i=e.link.functions[0];n=t.getContext(i.name[0])}return n}function $(t,e,n){const s=e[0];if(null!=t.BindTree[s])return;const a={key:s,val:t.getValue(s),pro:void 0};t.BindDef.add(a);try{t.Root.hasOwnProperty(s)||(t.Root[s]=null),Object.defineProperty(t.Root,s,{get:function(){if(void 0!==a.pro)return a.pro;if(i(a.val))return a.val;for(;a.val[o];)a.val=a.val[l];return a.pro=f(a.val,t.BoundEventProxy,a,[a.key]),a.pro},set:function(e){a.val=e;const n=(()=>{if(i(e))return delete a.pro,a.val;for(;a.val[o];)a.val=a.val[l];return a.pro=f(a.val,t.BoundEventProxy,a,[a.key]),a.pro})();return t.eventPRoxy(0,[a.key],e,a),n}})}catch(e){r(e.message,s,t.Root)}}function L(t,e,n){let i=t.BindTree;for(let s=0,r=e.length;s<r;s++){const o=e[s];if(0==s){const i=t.getContext(o);if($(i,e),i!=t)return n.gtpl=t,t.BindMap||(t.BindMap=new Map),t.BindMap.set(n,i),void L(i,e,n)}null==i[o]&&(i[o]={}),s<r-1?(i=i[o],null==i.tree&&(i.tree={}),i=i.tree):i=i[o]}null==i.me&&(i.me=new Set),i.me.add(n)}function F(t,e,n){let i=t.BindTree;for(let t=0,n=e.length;t<n;t++){const s=e[t];t<n-1?(i=i[s],i=i.tree):i=i[s]}return i.me}function J(t,e){if(e.link.vorc&&e.link.vorc.va&&F(t,e.link.vorc.va).delete(e),e.link.formula?.vars&&e.link.formula.vars.forEach(n=>{F(t,n).delete(e)}),e.simetric&&e.ele){const n=O.get(e.ele);if(n){const i=new Set(Array.from(n).filter(e=>e.ctx!==t));i.size?O.set(e.ele,i):O.delete(e.ele)}}}function W(t,e){let n=!1;if(e.link.vorc&&e.link.vorc.va&&F(t,e.link.vorc.va).has(e)&&(n=!0),e.link.formula?.vars&&e.link.formula.vars.forEach(i=>{F(t,i).has(e)&&(n=!0)}),!n){const n=B.getProperty(t,"renderElements");n.has(e)&&n.delete(e)}return n}function z(t,e){if(7==e.type&&e.prop&&e.link&&e.link.vorc&&e.link.vorc.va){const{prop:n}=e;if(n.startsWith("[")&&n.endsWith("]")){!function(){if(S.binitChangeEvents)return;S.binitChangeEvents=!0;const t=new WeakMap,e=function(e){const n=e.target;if(("change"!==e.type||!t.has(n)||t.get(n)!==n.value)&&O.has(n)){const e=O.get(n);if(e){for(let t of e)V(t.va,t.ctx,n.value);t.set(n,n.value)}}};m&&"function"==typeof m.addEventListener&&(m.addEventListener("input",e),m.addEventListener("change",e))}(),e.simetric=!0,e.prop=n.slice(1,-1);const i=e.link.vorc.va,s=t.getContext(i[0]);if("value"==e.prop&&(O.has(e.ele)||O.set(e.ele,new Set),O.get(e.ele)?.add({va:i,ctx:s})),e.prop in e.ele.constructor.prototype){const t=Object.getOwnPropertyDescriptor(e.ele.constructor.prototype,e.prop);t?Object.defineProperty(e.ele,e.prop,{get:function(){return t.get.call(this)},set:function(n){if("value"==e.prop&&"select"==e.ele.nodeName.toLowerCase()){const e=t.set.call(this,n);return t.get.call(this)==n?V(i,s,n):console.error("select value not valid",n+" not in options"),e}return V(i,s,n),t.set.call(this,n)}}):console.error("simetric attr error",e.prop," not in ",e.ele.constructor.prototype)}else console.error("simetric attr error",e.prop," in ",e.ele)}}}function I(t){if(Array.isArray(t))t.forEach(t=>{I(t)});else{if(t[P]){for(const{type:e,handler:n,options:i}of t[P])t.removeEventListener(e,n,i);delete t[P]}if(t instanceof Element)for(;t.attributes.length>0;)t.removeAttribute(t.attributes[0].name);t.destroy?t.destroy(!0):t.parentNode?.removeChild(t)}}function _(t,e,n,i,s=[],r=0){if(!t)return s;if(t.me&&t.me.forEach(t=>{const o=0===r?i:void 0,l=n.slice(r);s.push([e,t,l,o])}),t.tree){const o=n[r];for(const l in t.tree)if(void 0===o||o===l){const a=void 0!==i?void 0===o?i:i[l]:void 0;_(t.tree[l],e,n,a,s,r+1)}}return s}function K(t,e,n){if(n){const n=B.getProperty(t,"MarkEle"),i=B.getProperty(t,"memValues");e.ele?n.has(e.mark)&&e.ele!=n.get(e.mark)&&(e.ele=n.get(e.mark),i.delete(e)):e.mark&&(e.gen?(n.has(e.mark)?e.ele=n.get(e.mark):(e.ele=e.gen(e.gtpl?e.gtpl:t),n.set(e.mark,e.ele)),delete e.gen):n.has(e.mark)&&(e.ele=n.get(e.mark),i.delete(e)))}}function Z(t,e=!0){t.ele&&(Array.isArray(t.ele)?t.ele.forEach(e=>{t.mark.parentNode.insertBefore(e,t.mark)}):t.mark.parentNode.insertBefore(t.ele,t.mark),e&&t.mark.remove())}function H(t,e=!0){t.ele&&(Array.isArray(t.ele)?(e&&t.ele[0].parentNode.insertBefore(t.mark,t.ele[0]),t.ele.forEach(t=>{t.remove()})):(e&&t.ele.parentNode.insertBefore(t.mark,t.ele),t.ele.remove()))}function X(t,e,n){const i=Y(t,e),s=function(t){let e=!0;if(t.mark.checks)for(let n in t.mark.checks)if(!t.mark.checks[n]){e=!1;break}return e}(e);return n&&s?(i>=0&&(t.RenderElements[i]=e),e.mark.parentNode?Z(e):i>=0&&W(t,e)&&j(t,e)):(i>=0&&delete t.RenderElements[i],e.ele.parentNode?H(e):i>=0&&W(t,e)&&j(t,e)),!(n&&!s)}function Y(t,e){const n=t.Elements.indexOf(e.mark);return n>=0&&(t.RenderElements||(t.RenderElements={})),n}function U(t,e,n,i,s,r){const o={parent:e.gtpl?e.gtpl:t,generator:e.gen};if(n&&i&&s){const t={};t[n.index]=i.length,t[n.target]=s,o.context=[n.index,n.target],o.root=t}return void 0!==r&&(o.refresh=r),new q(o)}class q{ID;FncElements;Elements;RenderElements;BindTree;BindConst;BindMap;BindDef;GtplChilds;Parent;Context;Root;BoundEventProxy;cleanupCallbacks;isDestroyed=!1;constructor(t){this.ID=Math.random().toString(16).slice(2),this.BindTree={},this.BindConst=new Set,this.BindDef=new Set,this.GtplChilds=new Set,this.BoundEventProxy=this.eventPRoxy.bind(this),this.loadOptions(t)}loadOptions(t){t&&(this.Root=t.root,t.parent&&(this.Parent=t.parent),t.context&&(this.Context=new Set(t.context)),t.generator&&(this.FncElements=t.generator,this.Elements=[],A(this.Elements,this.FncElements,this)),B.setProperty(this,"GenerationFinish",!0),void 0!==t.refresh&&!0!==t.refresh||this.refresh())}getValue(t){const e=this.Root;if(e){if(e.hasOwnProperty(t))return e[t];if(void 0!==e[t])return e[t]}if(this.Parent)return this.Parent.getValue(t)}getGtplRoot(){return this.Parent?this.Parent.getGtplRoot():this}getRoot(){return this.Parent?this.Parent.getRoot():this.Root}getContext(t){return this.Context&&this.Context.has(t)?this:this.Parent?this.Parent.getContext(t):this.getGtplRoot()}addBind(t){this.checkDestroyed("addBind")||(function(t,e){if(15==e.type){if(e.link.svar&&e.link.vorc&&e.link.vorc.va){const n=e.link.vorc.va.join("");e.ele[e.link.svar]="this"==n?t.Root:G(t,e.link.vorc.va)}return!0}return!1}(this,t)||function(t,e){if(6==e.type&&e.prop){const n={gtpl:T(t,e),bind:e},i={passive:!1};["wheel","mousewheel","touchstart","touchmove"].includes(e.prop.toLowerCase())&&(i.passive=!0);const s=async function(e){const i=await D(n.gtpl,n.bind,void 0,e);if("function"==typeof i)if(n.bind.link.params){const s=[];n.bind.link.params.forEach(e=>{null!=e.ct?s.push(e.ct):null!=e.va&&s.push(G(t,e.va))}),i.apply(n.gtpl.Root,[e,...s])}else i.apply(n.gtpl.Root,[e]);else!1===i&&(e.preventDefault&&e.preventDefault(),e.stopPropagation&&e.stopPropagation())};return e.ele.addEventListener(e.prop,s,!!k&&i),e.ele[P]||(e.ele[P]=[]),e.ele[P].push({type:e.prop,handler:s,options:!!k&&i}),!0}return!1}(this,t)||function(t,e){let n=!1;return e.link.formula&&e.link.formula.vars&&e.link.formula.vars.length&&(n=!0,e.link.formula.vars.forEach(n=>{L(t,n,e)})),n}(this,t)||function(t,e){let n=!1;return e.link.vorc&&e.link.vorc.va&&(n=!0,z(t,e),L(t,e.link.vorc.va,e)),e.link.functions&&e.link.functions.forEach(i=>{i.params&&i.params.forEach(i=>{i.va&&(n=!0,L(t,i.va,e))})}),n}(this,t)||this.BindConst.add(t),B.getProperty(this,"GenerationFinish")&&this.launchChange(4,t))}checkDestroyed(t){return!!this.isDestroyed&&(console.warn(`[GTPL] Cannot perform ${t} on destroyed component`,this.ID),!0)}destroy(t=!0){if(this.isDestroyed)console.warn("[GTPL] Component already destroyed",this.ID);else{if(this.cleanupCallbacks&&this.cleanupCallbacks.size>0&&(this.cleanupCallbacks.forEach(t=>{try{t()}catch(t){console.error("[GTPL] Error in cleanup callback:",t)}}),this.cleanupCallbacks.clear()),this.isDestroyed=!0,this.GtplChilds.forEach(t=>t.destroy(!1)),this.GtplChilds.clear(),this.BindDef){for(const t of this.BindDef)p(t.val,this.BoundEventProxy);this.BindDef.clear()}if(this.BindMap){for(const[t,e]of this.BindMap)J(e,t);this.BindMap.clear()}if(t&&(I(this.Elements),this.RenderElements)){const t=Array.isArray(this.Elements)?this.Elements.length:1;for(let e=0;e<t;e++){const t=this.RenderElements[e];t&&(t.ele&&I(t.ele),t.eles&&I(t.eles))}this.RenderElements=null}this.Elements=null,this.Root=null,this.BindTree=null,this.BindConst=null,this.Context=null,this.Parent=null}}onCleanup(t){this.isDestroyed||"function"==typeof t&&this.cleanupCallbacks.add(t)}refresh(){for(let t of this.BindDef)this.eventPRoxy(4,[],void 0,t);if(this.BindMap)for(let[t,e]of this.BindMap)e.launchChange(5,t);if(this.BindConst)for(let t of this.BindConst)this.launchChange(6,t)}addTo(t){if(!this.checkDestroyed("addBind"))if(this.RenderElements){const e=[];(Array.isArray(this.Elements)?this.Elements:[this.Elements]).forEach((t,n)=>{if(this.RenderElements[n]){const t=this.RenderElements[n];t.ele?e.push(t.ele):t.eles&&(t.eles.forEach(t=>t.addTo(e)),e.push(t.mark))}else e.push(t)}),A(t,e,this)}else A(t,this.Elements,this)}eventPRoxy(t,e,n,i){const s=e;s?.shift(),_(this.BindTree[i.key],t,e,n,[],1).forEach(t=>this.launchChange.apply(this,t))}async launchChange(t,e,n,i){if(this.checkDestroyed("launchChange"))return;if(6==e.type)return;const s=await D(this,e,i);let a=this;switch(e.type){case 0:a=await async function(t,e,n,i){e=T(e,n);const s=B.getProperty(e,"memValues");if(null!=i){if(s.has(n)&&s.get(n)==i)return e;s.set(n,i)}return n.ele.textContent=i,e}(0,this,e,s);break;case 7:a=await async function(t,e,n,i){e=T(e,n);const s=(t,e)=>{if(void 0!==n.ele[t]&&null!==n.ele[t]){if(null==e)""!==n.ele[t]&&(n.ele[t]=null);else if(n.ele[t]!=e)try{n.ele[t]=e}catch(e){r(e.message,n.ele,t)}}else null==e?n.ele.removeAttribute(t):n.ele.getAttribute(t)!=e&&n.ele.setAttribute(t,e)};if(n.prop)s(n.prop,i);else if(null==i)n.attrs&&(n.attrs.forEach(t=>{s(t,null)}),delete n.attrs);else{n.attrs||(n.attrs=[]),n.attrs.filter(t=>!(t in i)).forEach(t=>{s(t,null)}),n.attrs.length=0;for(let t in i)n.attrs.push(t),s(t,i[t])}return e}(0,this,e,s);break;case 9:a=await async function(t,e,n,i){return e=T(e,n),void 0!==i&&n.ele.innerHTML!=i&&(n.ele.innerHTML=i),e}(0,this,e,s);break;case 8:a=await async function(t,e,n,i){e=T(e,n);const s=B.getProperty(e,"memValues");return s.has(n)&&s.get(n)==i||(s.set(n,i),n.prop&&(n.ele.style[n.prop]=i)),e}(0,this,e,s);break;case 1:case 2:a=await async function(t,e,n,i){e=T(e,n);const s=2==n.type?!i:!!i;if(n.mark.checks||(n.mark.checks={}),n.mark.checks[n.type]=s,K(e,n,s),!n.ele)return e;const r=B.getProperty(e,"memValues");return r.has(n)&&r.get(n)===s||X(e,n,s)&&r.set(n,s),e}(0,this,e,s);break;case 5:a=await async function(t,e,n,i,s){e=T(e,n),n.eles||(n.eles=[]);const r=n.eles,o=n.link.index,l=[],a=[],h=Array.isArray(s)&&s.length?s[0]:void 0;if(isNaN(h))if(i&&i.length){if("length"==h&&r.length==i.length)return e;i.forEach((t,i)=>{if(i>=r.length){const s=U(e,n,o,r,t,!1);r.push(s),l.push([s,i])}else r[i].Root[o.target]=t}),r.length>i.length&&r.splice(i.length,r.length-i.length).forEach((t,e)=>{a.push([t,e])})}else r.length&&(r.forEach((t,e)=>{a.push([t,e])}),r.length=0);else{const c=s;if(0==t){let t=!1;if(c.length>1)t=!0;else if(1==c.length&&r.length==i.length)return r[h].Root[o.target]=i[h],e;if(t){const t=r[h];c.shift(),V(c,{Root:t.Root[o.target]},G(e,c,i[h]),!0)}else{const t=U(e,n,o,r,i[h],!1);r.push(t),l.push([t,h])}}if(1==t)if(c.length>1)r[h].Root[o.target]=i[h];else{const t=r.splice(h,1)[0];a.push([t,h])}}if(a.length&&a.forEach(t=>{const[n,i]=t;n.destroy(),e.GtplChilds.delete(n)}),l.length){const t=Y(e,n);t>=0&&(e.RenderElements[t]||(e.RenderElements[t]=n));const i=[];l.forEach(t=>{const[n,s]=t;n.addTo(i),e.GtplChilds.add(n)}),n.mark.parentNode?(Z({type:n.type,link:n.link,ele:i,mark:n.mark},!1),l.forEach(t=>{t[0].refresh()})):t>=0&&W(e,n)&&j(e,n)}return e}(t,this,e,s,n);break;case 3:a=await async function(t,e,n,i){e=T(e,n);const s=null!=i;if(n.mark.checks||(n.mark.checks={}),n.mark.checks[n.type]=s,K(e,n,s),n.mark.checks||(n.mark.checks={}),n.mark.checks[n.type]=null!=i,!n.ele)return e;const r=B.getProperty(e,"memValues");if(r.has(n)&&r.get(n)===i)return e;if(r.set(n,i),n.case&&n.case.length){if(n.eles&&n.eles.length&&(n.eles.forEach(t=>{H(t.refCase),t.destroy(),e.GtplChilds.delete(t)}),delete n.eles),!W(e,n))return e;if(s){if(!n.case[0].mark){const t={};for(let e=0,i=n.ele.childNodes.length;e<i;e++){const i=n.ele.childNodes[e];8===i.nodeType&&6==i.textContent.length&&(t[i.textContent]=i)}for(let e=0,i=n.case.length;e<i;e++){const i=n.case[e];!i.mark&&i.uid&&(i.mark=t[i.uid])}}for(let t=0,s=n.case.length;t<s;t++){const s=n.case[t];if(await D(e,s)==i){const t=U(e,s,void 0,void 0,void 0,!1);s.ele=t.Elements,s.eles=[t],t.refCase=s,e.GtplChilds.add(t),n.eles=s.eles;break}}}}return X(e,n,s)&&s&&(n.eles[0].refresh(),Z(n.eles[0].refCase)),e}(0,this,e,s);break;case 12:a=await async function(t,e,n,i){e=T(e,n);const s=null!=i,r=B.getProperty(e,"memValues");if(r.has(n)&&r.get(n)==i)return e;r.set(n,i);let a=!1;if(n.eles?(a=!0,n.eles[0].destroy(),e.GtplChilds.delete(n.eles[0]),delete n.eles):n.ele&&H(n),!s)return e;if(a&&!W(e,n))return e;if(Array.isArray(i)||"function"==typeof i){const t=U(e,{link:n.link,type:n.type,gtpl:n.gtpl,gen:i});n.eles=[t],e.GtplChilds.add(t),n.ele=t.Elements}else n.ele=i[o]?i[l]:i;return B.getProperty(e,"MarkEle").set(n.mark,n.ele),X(e,n,s),e}(0,this,e,s)}!function(t,e){const n=B.getProperty(t,"renderElements");if(!n.has(e))return;(Array.isArray(t.Elements)?t.Elements:[t.Elements]).forEach((e,i)=>{const s=t.RenderElements[i];if(s&&n.has(s)){let t=!0;if(s.ele){const e=Array.isArray(s.ele)?s.ele[0]:s.ele;s.mark.parentNode||e.parentNode?s.mark.parentNode&&!e.parentNode&&(Z(s),s.eles&&(s.eles[0].refresh(),s.eles[0].refCase&&Z(s.eles[0].refCase))):t=!1}else if(s.eles)if(s.mark.parentNode){let t=null;const e=[];s.eles.forEach(n=>{const i=[];n.refresh(),n.addTo(i),i.forEach(n=>{n.parentNode?t||(t=n):e.push(n)})}),e.length&&Z({type:s.type,link:s.link,ele:e,mark:t||s.mark},!1)}else t=!1;t&&n.delete(s)}})}(a,e)}}const Q=["abstract","await","boolean","break","byte","case","catch","char","class","const","continue","debugger","default","delete","do","double","else","enum","export","extends","false","final","finally","float","for","function","goto","if","implements","import","in","instanceof","int","interface","let","long","native","new","null","package","private","protected","public","return","short","static","super","switch","synchronized","this","throw","throws","transient","true","try","typeof","var","void","volatile","while","with","yield","arguments","async","eval","undefined"];class tt{s;i;l;r;arr_acepted;ln;constructor(){this.setAceptedAN()}getResult(){return this.r}getSingleResult(){let t=null;return this.r&&1==this.r.length&&(t=this.r[0]),t}setString(t){this.s=t,this.l=t.length,this.i=0,this.r=[]}setAceptedAN(t="_"){this.arr_acepted=Array.from(t).map(t=>t.charCodeAt(0))}checkStart(){return this.i+1<this.l&&"{"===this.s[this.i]&&"{"===this.s[this.i+1]}checkEnd(){return this.i+1<this.l&&"}"===this.s[this.i]&&"}"===this.s[this.i+1]}next(){return this.i++,!(this.i>=this.l)}nop(t=!1,e=null){let n=null;for(this.ln=null;;){if(n=this.s[this.i],e&&e.includes(n))return!0;let i=" "==n||"\t"==n||"\r"==n||"\n"==n;if(!i&&t&&(i='"'!=n&&"'"!=n&&!this.isAN(n),i&&(this.ln=n)),!i)return!0;if(!this.next())return!1}}isAN(t,e=!0){if(null==t)return!1;let n;for(let i=0,s=t.length,r=0;i<s;i++)if(r=t.charCodeAt(i),n=r>64&&r<91||r>96&&r<123||this.arr_acepted.indexOf(r)>=0,e&&(n=n||r>47&&r<58),!n)return!1;return!0}getVOrC(){let t=this.s[this.i];if('"'==t||"'"==t)return{ct:this.getConst()};if(this.isAN(t,!1))return{va:this.getVar()};if(this.isNumber(t)){const t=this.i,e=this.getNumber();if(null!==e)return{ct:e};this.i=t}return null}getVar(t=!0){let e,n=this.s[this.i],i=null;for(;;){if(!this.next())return""!=n?n.split("."):null;if(i=this.s[this.i],e=this.isAN(i),t&&!e&&(e="."==i),!e)return n.split(".");n+=i}}getConst(){const t=this.s[this.i];if(!this.next())return null;let e=this.s[this.i];if(e==t)return e="",this.next()?e:null;let n=null,i=null;for(;;){if(!this.next())return null;if(n=this.s[this.i],n==t&&"\\"!=i)return this.next()?e:null;e+=n,i=n}}isNumber(t){const e=t.charCodeAt(0);return e>=48&&e<=57}getNumber(){let t=this.s[this.i],e=null,n=!1;for(;this.next();){if(e=this.s[this.i],"."==e){if(n)return null;n=!0}else if(!this.isNumber(e))break;t+=e}return t}check(){let t,e,n,i=0,s="",r=!1;for(;;){if(this.checkStart()){if(r=!0,""!=s&&(this.r.push(s),s=""),t={},this.i+=2,i=this.i,!this.nop())return!1;if(e=this.getVOrC(),e){for(t.vorc=e;;){if(!this.nop())return!1;if(n=this.s[this.i],":"==n){if(!this.next())return!1;if(!this.nop())return!1;const i=this.getVar();if(null===i)return!1;t.functions||(t.functions=[]);const s={name:i};if(t.functions.push(s),!this.nop())return!1;if(n=this.s[this.i],"("==n){if(!this.next())return!1;if(!this.nop())return!1;if(n=this.s[this.i],null==n)break;if(")"==n){if(!this.next())return!1;continue}for(;;){if(e=this.getVOrC(),!e)return!1;if(s.params||(s.params=[]),s.params.push(e),!this.nop())return!1;if(n=this.s[this.i],null==n)break;if(","!=n){if(")"==n){if(!this.next())return!1;if(!this.nop())return!1;break}}else{if(!this.next())return!1;if(!this.nop())return!1}}}continue}break}if(n=this.s[this.i],"{"==n){if(!this.next())return!1;for(;;){if(!this.nop())return!1;if(n=this.s[this.i],null==n)break;if("}"==n){if(!this.next())return!1;if(!this.nop())return!1;break}if(","!=n){if(e=this.getVOrC(),!e)return!1;t.params||(t.params=[]),t.params.push(e)}else if(!this.next())return!1}}if(n=this.s[this.i],";"==n){if(!this.next())return!1;if(!this.nop())return!1;const e=this.getVar(!1);if(null===e)return!1;if(!this.nop())return!1;if(n=this.s[this.i],";"!=n)return!1;{if(!this.next())return!1;if(!this.nop())return!1;const n=this.getVar(!1);if(null===n)return!1;t.index={index:e.join(""),target:n.join("")}}}if(!this.nop())return!1;if(this.checkEnd())this.i++,this.r.push(t);else if(!this.searchFormula(i))return!1}else if(!this.searchFormula(i))return!1}else s+=this.s[this.i];if(!this.next())break}return""!=s&&this.r.push(s),r}searchFormula(t){let e=this.s.substring(t,this.i);for(;;){if(this.checkEnd()){this.i++,this.r.push({formula:{code:e,vars:this.findVars(e)}}),e="";break}if(e+=this.s[this.i],!this.next())return!1}return!0}findVars(t){let e=t.trim();const n=this.s,i=this.i,s=this.l;this.s=e,this.l=e.length,this.i=0;let r=[],o=[[]];const l=t=>{o[o.length-1].push(t)},a=t=>o.some(e=>e.indexOf(t)>=0),h=()=>{for(;this.i<this.l&&/\s/.test(this.s[this.i]);)this.i++},c=t=>{for(this.i++;this.i<this.l;)if("\\"===this.s[this.i])this.i+=2;else{if(this.s[this.i]===t){this.i++;break}this.i++}},u=()=>{for(this.i++;this.i<this.l;)if("\\"===this.s[this.i])this.i+=2;else if("$"===this.s[this.i]&&"{"===this.s[this.i+1]){this.i+=2;let t=1;const e=this.i;for(;this.i<this.l&&t>0;)"{"===this.s[this.i]?t++:"}"===this.s[this.i]&&t--,this.i++;const n=this.s.substring(e,this.i-1);this.findVars(n).forEach(t=>{a(t[0])||r.some(e=>e[0]===t[0])||r.push(t)})}else{if("`"===this.s[this.i]){this.i++;break}this.i++}},f=()=>{const t=this.i,e=this.getVOrC();if(e&&e.va){let n=t-1;for(;n>=0&&/\s/.test(this.s[n]);)n--;return n>=0&&"."===this.s[n]?null:e.va}return null},p=()=>{if("("!==this.s[this.i])return!1;const t=this.i;let e=0;for(;this.i<this.l;){const t=this.s[this.i];if("("===t)e++;else if(")"===t&&(e--,0===e))break;this.i++}const n=this.s.substring(t+1,this.i);return this.i++,h(),"=>"===this.s.substr(this.i,2)&&(n.split(",").forEach(t=>{const e=t.trim();e&&l(e)}),this.i+=2,!0)},d=()=>{if("catch"===this.s.substr(this.i,5)){if(this.i+=5,h(),"("===this.s[this.i]){this.i++,h();const t=f();for(t&&l(t[0]);this.i<this.l&&")"!==this.s[this.i];)this.i++;")"===this.s[this.i]&&this.i++}return!0}return!1},g=()=>{if("function"===this.s.substr(this.i,8)){this.i+=8,h();const t=f();if(t&&l(t[0]),h(),"("===this.s[this.i]){this.i++;let t="";for(;this.i<this.l&&")"!==this.s[this.i];)t+=this.s[this.i],this.i++;")"===this.s[this.i]&&this.i++,t.split(",").forEach(t=>{const e=t.trim();e&&l(e)})}return!0}return!1},y=["const","var","let","function"];for(;this.i<this.l&&(h(),!(this.i>=this.l));){const t=this.s[this.i];if("catch"===this.s.substr(this.i,5)){d();continue}if("function"===this.s.substr(this.i,8)){g();continue}if("/"===t&&"/"===this.s[this.i+1]){for(this.i+=2;this.i<this.l&&"\n"!==this.s[this.i];)this.i++;continue}if("/"===t&&"*"===this.s[this.i+1]){for(this.i+=2;this.i<this.l&&("*"!==this.s[this.i]||"/"!==this.s[this.i+1]);)this.i++;this.i+=2;continue}if('"'===t||"'"===t){c(t);continue}if("`"===t){u();continue}if("{"===t){o.push([]),this.i++;continue}if("}"===t){o.pop(),this.i++;continue}if("("===t){const t=this.i;if(p())continue;this.i=t}const e=f();if(e){if(y.indexOf(e[0])>=0){h();const t=f();t&&l(t[0]);continue}if(void 0!==m[e[0]])continue;if(Q.indexOf(e[0])>=0)continue;let t=this.i;for(;t<this.l&&/\s/.test(this.s[t]);)t++;if(":"===this.s[t])continue;if(a(e[0]))continue;r.some(t=>t[0]===e[0])||r.push(e);continue}this.i++}return this.s=n,this.i=i,this.l=s,r}}let et;const nt=/([a-zA-Z\_][\w]+)\s*\=\s*([a-zA-Z][\w\.]+)/gi;function it(t,e,n){return"g('"+t+"',"+(e||"null")+","+(n||"null")+",o)"}function st(t,e,n){if(n){let i=[];return n.forEach(t=>{i.push("const "+t.var+"="+t.gen+";")}),"((o)=>{"+i.join("")+"return "+t+"})"+(e?"":"(o)")}return"((o)=>"+t+")"+(e?"":"(o)")}function rt(t,e,n,i){let s=at([t],!0);return s=s.substring(0,s.length-1),s=s+',"gen":'+(n||e)+(i||"")+"}",s}function ot(t,e,n,i,s,r){return t.uid=e,n?(""!=i&&(i+=","),i+=rt(t,e,void 0,r)):(""!=s&&(s+=","),s+=rt(t,e,void 0,r)),{jsonAttr2:i,jsonAttr:s}}function lt(n,i,s){let r=null;switch(i){case"g-is":r=r||12;case"g-binds":r=r||11;case"g-bind":r=r||10;case"g-attr":r=r||7;case"g-if":r=r||1;case"g-notif":r=r||2;case"g-switch":r=r||3;case"g-case":r=r||4;case"g-for":r=r||5;case"g-inner":if(r=r||9,et.setString(`{{${s}}}`),et.check()){const t={type:r,link:et.getSingleResult()};return 12===r?n.unshift(t):n.push(t),!0}break;case"g-var":if(r=r||15,s.match(nt)){const t=s.split(nt);return n.push({type:r,link:{svar:t[1],vorc:{va:t[2].split(".")}}}),!0}break;case"g-tpl":return r=r||14,n.push({type:r,link:{vorc:{ct:s}}}),!0;case"g-style":s.includes("{{")||(s=`{{${s}}}`);case"style":let o="";if(et.setString(s),et.check()){let i=et.getResult();if(i&&i.length){if(1==i.length)return n.push({type:8,prop:"cssText",link:i[0]}),!0;const r=t(s);for(const[t,s]of Object.entries(r))et.setString(s),et.check()?(i=et.getSingleResult(),n.push({type:8,prop:t,link:i})):(o+=o?";":"",o+=`${e(t)}:${s}`);return""!=o&&n.push(["style",o]),!0}}break;default:if(et.setString(s),et.check()){const t=et.getResult();if(t&&1==t.length){const e={type:i.startsWith("on")?6:7,prop:i.startsWith("on")?i.substring(2):i,link:t[0]};return n.push(e),!0}}}return!1}function at(t,e=!1){const n=t.map(t=>{if(Array.isArray(t)||"string"==typeof t)return JSON.stringify(t);{const e=t;if(e.link?.formula){return`{${Object.entries(e).map(([t,e])=>{if("link"===t){return`"${t}":{${Object.entries(e).map(([t,e])=>{if("formula"===t){const{vars:n,code:i}=e;if(null!=i){const e=n?.map(t=>t[0]).join(",")||"",s=i.match(/[\s;]await[\W]/gm)?" async ":"",r=`{${i}}`;return`"${t}":{"vars":${JSON.stringify(n)},"fnc":${s}function(${e})${r}}`}s("formula without code")}return`"${t}":${JSON.stringify(e)}`}).join(",")}}`}return`"${t}":${JSON.stringify(e)}`}).join(",")}}`}return JSON.stringify(t)}});return e?n.join(","):`[${n.join(",")}]`}let ht=0,ct=0;function ut(){ct>=60466176&&(ct=0,ht++,ht>=26&&(ht=0));const t=String.fromCharCode(97+ht),e=ct.toString(36).padStart(5,"0");return ct++,t+e}async function ft(t,e,n,i){null==et&&(et=new tt);let s,r,o,l,a,h,c,u,f,p,d,g,y,k,v,b,E="";!1!==n&&(E="[");for(var w=0,C=t.length;w<C;w++){var x=t[w];switch(s=r=o=l=a=h=null,p=d=g=y=k="",x.nodeType){case 1:if("script"==x.nodeName.toLowerCase()){"["!=E&&(E+=","),E+=it(x.nodeName,JSON.stringify(x.textContent));continue}c=x,v=[];for(let t=0,e=c.attributes.length,n=c.attributes;t<e;t++){const e=n.item(t);if(e)if(lt(v,e.name,e.value)){if(v.length){const t=v[v.length-1];if(t){if(12==t.type&&(a=t,v.pop()),1!=t.type&&2!=t.type||(l=t,v.pop()),5==t.type&&(s=t,v.pop()),3==t.type&&(r=t,v.pop()),4==t.type){if(!i)throw new Error("not switch");i.case||(i.case=[]),i.case.push(t),o=t,o.index=i.case.length-1,v.pop()}14==t.type&&(h=t,v.pop())}}}else v.push([e.name,e.value])}if(s&&o)throw new Error("not for and case "+Array.from(c.attributes,t=>t.name+'="'+t.value+'"').join(" "));if(l&&o)throw new Error("not if and case "+Array.from(c.attributes,t=>t.name+'="'+t.value+'"').join(" "));if(a&&(o||r||h))throw new Error("not is and ( case or switch ot tpl ) "+Array.from(c.attributes,t=>t.name+"="+t.value+'"').join(" "));if("["!=E&&""!=E&&(E+=","),h){const t=h.link.vorc.ct,n=m.document.getElementById(t);if(n)u="template"==c.nodeName.toLowerCase()?e:c,f="template"==n.nodeName.toLowerCase()?n.content.childNodes:[n],p=await ft(f,u,!0,r);else{const e=await(await fetch(t)).text(),n=(new DOMParser).parseFromString(e.trim(),"text/html");p=await ft(n.body.childNodes,u,!0,r)}}else u="template"==c.nodeName.toLowerCase()?c.content:c,f=u.childNodes,p=await ft(f,u,!0,r);if(a||l||o||s||r){b=ut(),d="",g="";const t=[];if(k=at(v),a&&({jsonAttr2:g,jsonAttr:d}=ot(a,b,s,g,d)),l&&({jsonAttr2:g,jsonAttr:d}=ot(l,b,s,g,d)),r){r.uid=b;const e=r.case;delete r.case,y="",e&&e.forEach(e=>{if(e.common&&(e.common.forEach(e=>t.push(e)),delete e.common),e.gen){const t=e.gen;delete e.gen,""!=y&&(y+=","),y+=rt(e,null,t)}}),({jsonAttr2:g,jsonAttr:d}=ot(r,b,s,g,d,',"case":['+y+"]"))}h?"template"==c.nodeName.toLowerCase()?t.push({var:b,gen:p}):t.push({var:b,gen:st(it(c.nodeName,k,p),!0)}):t.push({var:b,gen:a?"null":st(it(c.nodeName,k,p),!0)}),o?(o.uid=b,o.gen=b,o.common=t,E+=st(it("#comment","["+JSON.stringify(b)+","+d+"]"),e)):s?(l||a||r?(s.uid=ut(),""!=d&&(d+=","),d+=rt(s,s.uid),t.push({var:s.uid,gen:st(it("#comment","["+JSON.stringify(b)+","+g+"]"),!0)})):(s.uid=b,""!=d&&(d+=","),d+=rt(s,b)),E+=st(it("#comment","["+JSON.stringify(s.uid)+","+d+"]"),e,t)):E+=st(it("#comment","["+JSON.stringify(b)+","+d+"]"),e,t)}else h&&"template"==c.nodeName.toLowerCase()?E+=p:E+=st(it(c.nodeName,at(v),p),e);break;case 3:{let t=!0;if(x.nodeValue&&(et.setString(x.nodeValue),et.check())){t=!1;const e=et.getResult();e&&e.length&&e.forEach(t=>{"["!=E&&""!=E&&(E+=","),E+=it(x.nodeName,"string"==typeof t?JSON.stringify(t):at([{type:0,prop:"textContent",link:t}]))})}t&&("["!=E&&""!=E&&(E+=","),E+=it(x.nodeName,JSON.stringify(x.nodeValue)))}break;case 6:"["!=E&&""!=E&&(E+=","),E+=it(x.nodeName,JSON.stringify(x.nodeValue))}}return!1!==n&&(E+="]"),void 0===e?"(o)=>"+E:E}var pt={GTpl:q,GAddToo:A,GregisterDirective:N,GGenerator:x,GProxy:f,jit:{GCompile:R,GCode:async function(t){if("string"==typeof t){return ft((new DOMParser).parseFromString(t.trim(),"text/html").body.childNodes)}return ft(t instanceof Node?[t]:t)}},utils:{stack:r,css2obj:t,style2css:e,globalObject:m,passiveSupported:k,isGProxy:c,unGProxy:function t(e){if(c(e)&&(e=e[l]),Array.isArray(e))return e.map(t);if(e&&"object"==typeof e){const n={};for(const i of Reflect.ownKeys(e))n[i]=t(e[i]);return n}return e},PROXYTARGET:l,ISPROXY:o,activateMemoryLeakObserver:function(){new PerformanceObserver(t=>{for(const e of t.getEntries())console.warn("Posible memory leak:",e)}).observe({entryTypes:["measure"]})}}};return pt}();
//# sourceMappingURL=gtpl.global.js.map
